(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[357],{3683:function(e,t,s){Promise.resolve().then(s.bind(s,2161))},2161:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return o}});var r=s(7437),n=s(2265),a=s(6013),l=s(495),i=s(3102);function o(){var e;let[t,s]=(0,n.useState)(null),[o,c]=(0,n.useState)(null),[u,x]=(0,n.useState)(null),[m,f]=(0,n.useState)(null),[p,h]=(0,n.useState)(null),[g,b]=(0,n.useState)(null),[v,j]=(0,n.useState)(null),[N,w]=(0,n.useState)(!1),[y,k]=(0,n.useState)(""),C=(0,n.useCallback)(async()=>{w(!0),c(null),b(null),h(null);try{let e=performance.now(),t=await fetch("/healthz",{credentials:"include"}),r=performance.now()-e;if(x(r),f(Date.now()),!t.ok){c("健康检查接口返回 ".concat(t.status)),s(null),b("健康检查失败，未尝试读取指标");return}let n=await t.json();s(n);try{let e=await fetch("/metrics",{credentials:"include"});if(j(Date.now()),e.ok){let t=await e.text();h(t)}else b("指标接口返回 ".concat(e.status)),h(null)}catch(e){b((null==e?void 0:e.message)||"无法获取指标数据"),h(null)}}catch(e){c((null==e?void 0:e.message)||"无法连接到健康检查接口"),s(null),b("健康检查失败，未尝试读取指标"),h(null)}finally{w(!1)}},[]);(0,n.useEffect)(()=>{C()},[C]);let O=(0,n.useMemo)(()=>o?"bg-rose-500":(null==t?void 0:t.status)&&"ok"!==t.status.toLowerCase()?"bg-amber-500":"bg-emerald-500",[null==t?void 0:t.status,o]),z=o?"不可用":(null==t?void 0:null===(e=t.status)||void 0===e?void 0:e.toUpperCase())||"UNKNOWN",S=(0,n.useMemo)(()=>{if(!p)return"-";let e=p.split("\n").filter(e=>e&&!e.startsWith("#"));return"".concat(e.length," 条样本")},[p]),L=(0,n.useMemo)(()=>p?function(e){let t=e.split(/\r?\n/),s=new Map,r={},n={};for(let e of t){let t=e.trim();if(!t)continue;if(t.startsWith("# HELP ")){let e=t.slice(7),s=e.indexOf(" ");if(s>0){let t=e.slice(0,s),n=e.slice(s+1);r[t]=n}continue}if(t.startsWith("# TYPE ")){let e=t.slice(7),s=e.indexOf(" ");if(s>0){let t=e.slice(0,s),r=e.slice(s+1);n[t]=r}continue}if(t.startsWith("#"))continue;let a=t.match(/^([^\s{]+)(\{[^}]*\})?\s+([^\s]+)(?:\s+[^\s]+)?$/);if(!a)continue;let l=a[1],i=a[2],o=a[3],d={};if(i)for(let e of i.slice(1,-1).split(/,(?=(?:[^"\\]|\\.|"[^"]*")*$)/)){if(!e)continue;let t=e.indexOf("=");if(-1===t)continue;let s=e.slice(0,t).trim(),r=e.slice(t+1).trim();r.startsWith('"')&&r.endsWith('"')&&(r=r.slice(1,-1).replace(/\\"/g,'"')),d[s]=r}s.has(l)||s.set(l,{name:l,help:r[l],type:n[l],samples:[]}),s.get(l).samples.push({labels:d,value:o})}return Array.from(s.values()).sort((e,t)=>e.name.localeCompare(t.name))}(p):[],[p]),_=(0,n.useMemo)(()=>{let e=y.trim().toLowerCase();return e?L.filter(t=>{var s;return!!(t.name.toLowerCase().includes(e)||(null===(s=t.help)||void 0===s?void 0:s.toLowerCase().includes(e)))||t.samples.some(t=>Object.entries(t.labels).some(t=>{let[s,r]=t;return"".concat(s,"=").concat(r).toLowerCase().includes(e)}))}):L},[y,L]),W=async()=>{if(p)try{await navigator.clipboard.writeText(p),alert("指标内容已复制到剪贴板")}catch(e){alert("复制失败，请手动复制")}};return(0,r.jsx)("div",{className:"container py-10",children:(0,r.jsxs)(a.Zb,{className:"max-w-3xl",children:[(0,r.jsxs)(a.Ol,{children:[(0,r.jsx)(a.ll,{children:"平台状态"}),(0,r.jsx)(a.SZ,{children:"调用后端 /healthz 接口获取核心服务运行情况"})]}),(0,r.jsxs)(a.aY,{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("span",{className:"h-3 w-3 rounded-full ".concat(O),"aria-hidden":!0}),(0,r.jsx)("span",{className:"text-lg font-semibold text-foreground",children:z}),(0,r.jsx)(l.z,{variant:"outline",size:"sm",onClick:C,disabled:N,children:N?"检测中...":"重新检测"})]}),(0,r.jsxs)("div",{className:"grid gap-4 rounded-xl border border-border/60 bg-background/80 p-4 text-sm text-muted-foreground md:grid-cols-3",children:[(0,r.jsx)(d,{label:"最近检测时间",value:m?new Date(m).toLocaleString():"尚未检测"}),(0,r.jsx)(d,{label:"响应耗时",value:null!==u?"".concat(u.toFixed(1)," ms"):"-"}),(0,r.jsx)(d,{label:"健康响应字段",value:t&&Object.keys(t).join(", ")||"-"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-foreground",children:"原始响应"}),(0,r.jsx)("pre",{className:"mt-2 max-h-64 overflow-auto rounded-lg bg-slate-950/90 p-4 text-xs text-slate-200 dark:bg-slate-900",children:JSON.stringify(o?{error:o}:t||{},null,2)})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-foreground",children:"Prometheus 指标 (/metrics)"}),(0,r.jsx)(l.z,{variant:"outline",size:"sm",onClick:W,disabled:!p,children:"复制全部"}),(0,r.jsx)(l.z,{variant:"outline",size:"sm",onClick:()=>{var e;let t=new Blob([null!==(e=null!=p?p:g)&&void 0!==e?e:""],{type:"text/plain;charset=utf-8"}),s=URL.createObjectURL(t),r=document.createElement("a");r.href=s,r.download="metrics.txt",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)},disabled:!p&&!g,children:"下载文本"})]}),(0,r.jsxs)("div",{className:"grid gap-4 rounded-xl border border-border/60 bg-background/80 p-4 text-sm text-muted-foreground md:grid-cols-3",children:[(0,r.jsx)(d,{label:"指标刷新时间",value:v?new Date(v).toLocaleString():"-"}),(0,r.jsx)(d,{label:"指标摘要",value:S}),(0,r.jsx)(d,{label:"状态",value:g?"错误: ".concat(g):"获取成功"})]}),p&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)(i.I,{value:y,onChange:e=>k(e.target.value),placeholder:"过滤指标名称或标签，例如 gc 或 http_request",className:"max-w-xl"}),(0,r.jsx)("div",{className:"max-h-72 overflow-auto rounded-lg border border-border/60 bg-background/80 p-3 text-xs text-foreground",children:_.length?(0,r.jsx)("div",{className:"space-y-3",children:_.map(e=>(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,r.jsx)("span",{className:"font-semibold text-sm text-foreground",children:e.name}),e.type&&(0,r.jsx)("span",{className:"rounded bg-secondary px-2 py-0.5 text-[11px] uppercase text-secondary-foreground",children:e.type}),(0,r.jsxs)("span",{className:"text-[11px] text-muted-foreground",children:[e.samples.length," samples"]})]}),e.help&&(0,r.jsx)("div",{className:"text-[11px] text-muted-foreground",children:e.help}),(0,r.jsx)("div",{className:"rounded-lg border border-border/40",children:(0,r.jsxs)("table",{className:"w-full border-collapse text-[11px]",children:[(0,r.jsx)("thead",{className:"bg-muted/40 text-muted-foreground",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"p-2 text-left",children:"Labels"}),(0,r.jsx)("th",{className:"p-2 text-left",children:"Value"})]})}),(0,r.jsx)("tbody",{children:e.samples.map((e,t)=>(0,r.jsxs)("tr",{className:"border-t border-border/30",children:[(0,r.jsx)("td",{className:"p-2 align-top font-mono text-[11px]",children:Object.keys(e.labels).length?Object.entries(e.labels).map(e=>{let[t,s]=e;return"".concat(t,'="').concat(s,'"')}).join(", "):"(no labels)"}),(0,r.jsx)("td",{className:"p-2 font-mono text-[11px] text-primary",children:e.value})]},t))})]})})]},e.name))}):(0,r.jsx)("div",{className:"text-muted-foreground",children:"未匹配到指标。"})})]}),(0,r.jsx)("pre",{className:"mt-2 max-h-72 overflow-auto rounded-lg bg-slate-950/90 p-4 text-xs text-slate-200 dark:bg-slate-900",children:g||(null!=p?p:"")})]})]})]})})}function d(e){let{label:t,value:s}=e;return(0,r.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,r.jsx)("span",{className:"text-xs uppercase tracking-wide text-muted-foreground/80",children:t}),(0,r.jsx)("span",{className:"text-sm text-foreground",children:s})]})}},495:function(e,t,s){"use strict";s.d(t,{z:function(){return o}});var r=s(7437);s(2265);var n=s(1538),a=s(3027),l=s(7440);let i=(0,a.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function o(e){let{className:t,variant:s,size:a,asChild:o=!1,...d}=e,c=o?n.g7:"button";return(0,r.jsx)(c,{"data-slot":"button",className:(0,l.cn)(i({variant:s,size:a,className:t})),...d})}},6013:function(e,t,s){"use strict";s.d(t,{Ol:function(){return l},SZ:function(){return o},Zb:function(){return a},aY:function(){return d},ll:function(){return i}});var r=s(7437);s(2265);var n=s(7440);function a(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card",className:(0,n.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...s})}function l(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:(0,n.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...s})}function i(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:(0,n.cn)("leading-none font-semibold",t),...s})}function o(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-description",className:(0,n.cn)("text-muted-foreground text-sm",t),...s})}function d(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:(0,n.cn)("px-6",t),...s})}},3102:function(e,t,s){"use strict";s.d(t,{I:function(){return a}});var r=s(7437);s(2265);var n=s(7440);function a(e){let{className:t,type:s,...a}=e;return(0,r.jsx)("input",{type:s,"data-slot":"input",className:(0,n.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...a})}},7440:function(e,t,s){"use strict";s.d(t,{cn:function(){return a}});var r=s(4839),n=s(6164);function a(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,n.m6)((0,r.W)(t))}}},function(e){e.O(0,[247,971,23,744],function(){return e(e.s=3683)}),_N_E=e.O()}]);