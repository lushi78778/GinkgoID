(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3648:function(e,t,r){Promise.resolve().then(r.bind(r,6774))},6774:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var n=r(7437),a=r(2265),s=r(7138),i=r(7651),l=r(6013),d=r(495);function c(){let{me:e,loading:t}=(0,i.a)(),[r,c]=(0,a.useState)([]),[u,h]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let t=!1;return(async()=>{if(!e){c([]);return}h(!0);try{let e=await fetch("/api/consents",{credentials:"include"});if(!e.ok)return;let r=await e.json();!t&&Array.isArray(r)&&c(r)}finally{t||h(!1)}})(),()=>{t=!0}},[e]);let f=(0,a.useMemo)(()=>[...r].sort((e,t)=>{var r,n;return(null!==(r=t.created_at)&&void 0!==r?r:0)-(null!==(n=e.created_at)&&void 0!==n?n:0)}),[r]),x=(0,a.useMemo)(()=>{if(!e)return[];let t=["用户"];return e.is_dev&&t.push("开发者"),e.is_admin&&t.push("管理员"),t},[e]),m=(0,a.useMemo)(()=>{if(!e)return[{label:"前往登录",href:"/login?next=%2F",external:!1},{label:"了解 OIDC",href:"/docs",external:!1}];let t=[{label:"个人资料",href:"/profile"},{label:"安全中心",href:"/security"},{label:"安全日志",href:"/logs"},{label:"隐私与数据",href:"/privacy"},{label:"授权应用",href:"/authorized"}];return e.is_dev&&(t.push({label:"客户端注册",href:"/clients"}),t.push({label:"应用日志",href:"/clients/logs"}),t.push({label:"授权用户",href:"/clients/users"}),t.push({label:"应用分析",href:"/clients/analytics"}),t.push({label:"平台状态",href:"/status"})),t.push({label:"OIDC 文档",href:"/docs"}),e.is_admin&&(t.push({label:"全局仪表盘",href:"/admin/dashboard"}),t.push({label:"系统策略",href:"/admin/settings"}),t.push({label:"品牌定制",href:"/admin/branding"})),t},[e]);return(0,n.jsxs)("div",{className:"container py-10 space-y-6",children:[(0,n.jsxs)(l.Zb,{children:[(0,n.jsxs)(l.Ol,{children:[(0,n.jsx)(l.ll,{children:"欢迎使用 GinkgoID 控制台"}),(0,n.jsx)(l.SZ,{children:"集中管理个人资料、授权记录与平台功能"})]}),(0,n.jsx)(l.aY,{className:"grid gap-3 text-sm",children:t?(0,n.jsx)("span",{className:"text-muted-foreground",children:"加载中..."}):e?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"grid gap-2 md:grid-cols-2",children:[(0,n.jsx)(o,{label:"用户名",value:e.username,bold:!0}),(0,n.jsx)(o,{label:"用户 ID",value:String(e.id),mono:!0}),(0,n.jsx)(o,{label:"姓名",value:e.name||"-"}),(0,n.jsx)(o,{label:"邮箱",value:e.email||"-"})]}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:x.map(e=>(0,n.jsx)("span",{className:"rounded-full bg-emerald-500/10 px-3 py-1 text-xs font-semibold text-emerald-600 dark:text-emerald-300",children:e},e))})]}):(0,n.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,n.jsx)("span",{children:"尚未登录，请先完成身份认证。"}),(0,n.jsx)("a",{className:"btn w-fit",href:"/login?next=%2F",children:"立即登录"})]})})]}),(0,n.jsxs)(l.Zb,{children:[(0,n.jsx)(l.Ol,{children:(0,n.jsx)(l.ll,{children:"快速入口"})}),(0,n.jsx)(l.aY,{className:"grid gap-3 text-sm md:grid-cols-3",children:m.map(e=>e.external?(0,n.jsx)("a",{className:"btn",href:e.href,target:"_self",children:e.label},e.label):(0,n.jsx)(s.default,{className:"btn",href:e.href,children:e.label},e.label))})]}),(0,n.jsxs)(l.Zb,{children:[(0,n.jsxs)(l.Ol,{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(l.ll,{children:"最近授权的应用"}),(0,n.jsx)(l.SZ,{children:"展示最近授权的客户端，方便快速管理"})]}),(0,n.jsx)(d.z,{variant:"outline",size:"sm",asChild:!0,children:(0,n.jsx)(s.default,{href:"/authorized",children:"查看全部"})})]}),(0,n.jsx)(l.aY,{children:u?(0,n.jsx)("div",{className:"py-6 text-sm text-muted-foreground",children:"正在加载授权信息..."}):f.length?(0,n.jsx)("div",{className:"grid gap-3 md:grid-cols-2",children:f.slice(0,6).map(e=>(0,n.jsxs)(s.default,{href:"/clients?focus=".concat(encodeURIComponent(e.client_id)),className:"rounded-xl border border-border/60 bg-background/80 p-4 transition hover:border-primary/60 hover:shadow-sm",children:[(0,n.jsx)("div",{className:"text-sm font-semibold text-foreground",children:e.client_name||e.client_id}),(0,n.jsxs)("div",{className:"mt-2 text-xs text-muted-foreground",children:["授权时间：",e.created_at?new Date(1e3*e.created_at).toLocaleString():"未知"]}),e.scope&&(0,n.jsx)("div",{className:"mt-3 flex flex-wrap gap-2",children:e.scope.split(/\s+/).filter(Boolean).map(e=>(0,n.jsx)("span",{className:"rounded-full bg-primary/10 px-2 py-1 text-[11px] text-primary",children:e},e))})]},e.client_id))}):(0,n.jsx)("div",{className:"py-6 text-sm text-muted-foreground",children:"暂无授权记录，完成授权后将展示在此处。"})})]})]})}function o(e){let{label:t,value:r,bold:a,mono:s}=e;return(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:t}),(0,n.jsx)("span",{className:"".concat(a?"font-semibold":""," ").concat(s?"font-mono text-[13px]":""),children:r})]})}},495:function(e,t,r){"use strict";r.d(t,{z:function(){return d}});var n=r(7437);r(2265);var a=r(1538),s=r(3027),i=r(7440);let l=(0,s.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function d(e){let{className:t,variant:r,size:s,asChild:d=!1,...c}=e,o=d?a.g7:"button";return(0,n.jsx)(o,{"data-slot":"button",className:(0,i.cn)(l({variant:r,size:s,className:t})),...c})}},6013:function(e,t,r){"use strict";r.d(t,{Ol:function(){return i},SZ:function(){return d},Zb:function(){return s},aY:function(){return c},ll:function(){return l}});var n=r(7437);r(2265);var a=r(7440);function s(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...r})}function i(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...r})}function l(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",t),...r})}function d(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",t),...r})}function c(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",t),...r})}},6264:function(e,t,r){"use strict";async function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={credentials:"include",headers:{Accept:"application/json",...t.headers||{}},...t},n=await fetch(e,r);if(401===n.status){let e=encodeURIComponent(window.location.pathname+window.location.search);throw window.location.href="/login?next=".concat(e),Error("unauthorized")}let a=await n.text(),s=n.headers.get("Content-Type")||"",i=a;if(s.includes("application/json"))try{i=JSON.parse(a)}catch(e){}if(!n.ok){let e=i&&(i.error||i.message)||n.statusText;throw Error("string"==typeof e?e:JSON.stringify(i))}return i}async function a(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n(e,{method:r.method||"POST",headers:{"Content-Type":"application/json",...r.headers||{}},body:JSON.stringify(t)})}r.d(t,{h:function(){return n},j:function(){return a}})},7651:function(e,t,r){"use strict";r.d(t,{H:function(){return l},a:function(){return d}});var n=r(7437),a=r(2265),s=r(6264);let i=(0,a.createContext)(null);function l(e){let{children:t}=e,[r,l]=(0,a.useState)(null),[d,c]=(0,a.useState)(!0),o=async()=>{try{let e=await (0,s.h)("/api/me");l(e)}catch(e){l(null)}finally{c(!1)}};(0,a.useEffect)(()=>{o()},[]);let u=async()=>{await fetch("/logout",{credentials:"include"}),window.location.href="/"},h=(0,a.useMemo)(()=>({me:r,loading:d,refresh:o,logout:u}),[r,d]);return(0,n.jsx)(i.Provider,{value:h,children:t})}function d(){return(0,a.useContext)(i)||{me:null,loading:!0,refresh:async()=>{},logout:async()=>{}}}},7440:function(e,t,r){"use strict";r.d(t,{cn:function(){return s}});var n=r(4839),a=r(6164);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}}},function(e){e.O(0,[247,138,971,23,744],function(){return e(e.s=3648)}),_N_E=e.O()}]);