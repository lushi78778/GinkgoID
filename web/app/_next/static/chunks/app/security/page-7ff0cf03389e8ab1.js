(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[127],{8225:function(e,t,r){Promise.resolve().then(r.bind(r,4862))},4862:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m}});var a=r(7437),s=r(6648),n=r(2265),i=r(6013),o=r(495),l=r(3102),d=r(6975),c=r(7776);let u={enabled:!1,secret:"JBSWY3DPEHPK3PXP",otpauth_url:"otpauth://totp/GinkgoID:demo%40example.com?secret=JBSWY3DPEHPK3PXP&issuer=GinkgoID",recovery_codes:["9K3D-G7PT","F2LM-1QZC","AZ3R-JX99","5MNC-QWER","4SDF-PLKM"],otpauth_qr:""},x=[{id:"current",created_at:Math.floor(Date.now()/1e3)-7200,last_seen_at:Math.floor(Date.now()/1e3),ip:"203.0.113.42",user_agent:"Mac \xb7 Chrome 126",location:"Shanghai, CN",current:!0},{id:"old-1",created_at:Math.floor(Date.now()/1e3)-86400,last_seen_at:Math.floor(Date.now()/1e3)-3600,ip:"198.51.100.10",user_agent:"Windows \xb7 Edge",location:"Beijing, CN"}];function m(){var e,t;let[r,m]=(0,n.useState)(null),[h,f]=(0,n.useState)([]),[v,p]=(0,n.useState)(!1),[g,b]=(0,n.useState)(!1),[j,w]=(0,n.useState)(""),[y,_]=(0,n.useState)(!1),N=(0,n.useCallback)(async()=>{p(!0);try{let e=await fetch("/api/security/mfa",{credentials:"include"});if(!e.ok)throw Error(await e.text());let t=await e.json();m({enabled:!!t.enabled,secret:t.secret,otpauth_url:t.otpauth_url,otpauth_qr:t.otpauth_qr,recovery_codes:t.recovery_codes,last_used_at:t.last_used_at,enrolled_at:t.enrolled_at})}catch(e){c.Am.error((null==e?void 0:e.message)||"无法获取 MFA 状态，显示示例数据"),m(u)}finally{p(!1)}},[]),k=(0,n.useCallback)(async()=>{b(!0);try{let e=await fetch("/api/security/sessions",{credentials:"include"});if(!e.ok)throw Error(await e.text());let t=await e.json();if(!Array.isArray(t))throw Error("响应格式不正确");let r=t.map(e=>{var t,r,a,s,n,i,o,l;return{id:String(null!==(r=null!==(t=e.id)&&void 0!==t?t:e.session_id)&&void 0!==r?r:crypto.randomUUID()),created_at:Number(null!==(s=null!==(a=e.created_at)&&void 0!==a?a:e.issued_at)&&void 0!==s?s:Date.now()/1e3),last_seen_at:Number(null!==(i=null!==(n=e.last_seen_at)&&void 0!==n?n:e.last_active_at)&&void 0!==i?i:Date.now()/1e3),ip:e.ip,user_agent:null!==(o=e.user_agent)&&void 0!==o?o:e.ua,location:e.location,current:!!(null!==(l=e.current)&&void 0!==l?l:e.is_current)}});f(r)}catch(e){c.Am.error((null==e?void 0:e.message)||"无法加载会话，显示示例数据"),f(x)}finally{b(!1)}},[]);(0,n.useEffect)(()=>{N(),k()},[N,k]);let A=(0,n.useMemo)(()=>!!(r&&!r.enabled&&(r.secret||r.otpauth_url)),[r]),S=async()=>{p(!0);try{let e=await fetch("/api/security/mfa/setup",{method:"POST",credentials:"include"});if(!e.ok)throw Error(await e.text());let t=await e.json();m({enabled:!1,secret:t.secret,otpauth_url:t.otpauth_url,otpauth_qr:t.otpauth_qr,recovery_codes:t.recovery_codes}),c.Am.success("已生成密钥，请使用 TOTP 应用扫描")}catch(e){c.Am.error((null==e?void 0:e.message)||"无法生成 TOTP 密钥，已使用示例数据"),m(u)}finally{p(!1)}},C=async()=>{if(!j.trim()){c.Am.error("请输入动态验证码");return}p(!0);try{let e=await fetch("/api/security/mfa/activate",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({code:j})});if(!e.ok)throw Error(await e.text());c.Am.success("已开启多因素认证"),w(""),await N()}catch(e){c.Am.error((null==e?void 0:e.message)||"验证失败，功能可能待后端实现")}finally{p(!1)}},E=async()=>{if(window.confirm("确定要关闭多因素认证吗？")){p(!0);try{let e=await fetch("/api/security/mfa",{method:"DELETE",credentials:"include"});if(!e.ok)throw Error(await e.text());c.Am.success("已关闭 MFA"),await N()}catch(e){c.Am.error((null==e?void 0:e.message)||"关闭失败，功能可能待后端实现")}finally{p(!1)}}},z=async e=>{if(window.confirm("确定要退出该会话吗？"))try{let t=await fetch("/api/security/sessions/".concat(encodeURIComponent(e)),{method:"DELETE",credentials:"include"});if(!t.ok)throw Error(await t.text());c.Am.success("已注销指定会话"),await k()}catch(e){c.Am.error((null==e?void 0:e.message)||"无法注销会话 (可能待后端实现)")}},D=async()=>{if(window.confirm("确定要退出除当前设备外的所有会话？"))try{let e=await fetch("/api/security/sessions",{method:"DELETE",credentials:"include"});if(!e.ok)throw Error(await e.text());c.Am.success("已注销其他会话"),await k()}catch(e){c.Am.error((null==e?void 0:e.message)||"操作失败，功能可能待后端实现")}},P=(e,t)=>{navigator.clipboard.writeText(e).then(()=>c.Am.success("".concat(t," 已复制"))).catch(()=>c.Am.error("复制失败"))};return(0,a.jsxs)("div",{className:"container py-10 space-y-6",children:[(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{children:[(0,a.jsx)(i.ll,{children:"多因素认证 (MFA)"}),(0,a.jsx)(i.SZ,{children:"为账户绑定基于时间的一次性密码 (TOTP)，推荐使用 Google Authenticator 或 1Password"})]}),(0,a.jsxs)(i.aY,{className:"grid gap-6 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"rounded-xl border border-border/60 bg-background/70 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("span",{className:"font-semibold text-foreground",children:"当前状态"}),(0,a.jsx)("span",{className:"rounded-full px-2 py-0.5 text-xs ".concat((null==r?void 0:r.enabled)?"bg-emerald-500/10 text-emerald-600":"bg-amber-500/10 text-amber-600"),children:(null==r?void 0:r.enabled)?"已开启":A?"待激活":"未开启"})]}),(null==r?void 0:r.enrolled_at)&&(0,a.jsxs)("div",{className:"mt-2 text-xs text-muted-foreground",children:["启用时间：",new Date(1e3*r.enrolled_at).toLocaleString()]}),(null==r?void 0:r.last_used_at)&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:["最近使用：",new Date(1e3*r.last_used_at).toLocaleString()]})]}),!(null==r?void 0:r.enabled)&&!A&&(0,a.jsx)(o.z,{onClick:S,disabled:v,children:v?"处理中...":"开始绑定 MFA"}),A&&(0,a.jsxs)("div",{className:"space-y-3",children:[(null==r?void 0:r.otpauth_qr)&&(0,a.jsx)("div",{className:"rounded-lg border border-border/60 bg-white p-3",children:(0,a.jsx)(s.default,{src:r.otpauth_qr,alt:"MFA QR 代码",width:192,height:192,className:"mx-auto h-48 w-48",unoptimized:!0})}),(0,a.jsx)("div",{className:"text-sm text-foreground font-medium",children:"步骤 1：在认证应用中添加账户"}),(0,a.jsx)("div",{className:"rounded-lg border border-dashed border-primary/40 bg-primary/5 p-3 text-xs font-mono text-primary",children:null==r?void 0:r.otpauth_url}),(null==r?void 0:r.secret)&&(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(o.z,{variant:"outline",size:"sm",onClick:()=>P(r.secret,"密钥"),children:"复制密钥"}),(0,a.jsx)(o.z,{variant:"outline",size:"sm",onClick:()=>P(r.otpauth_url||"","otpauth url"),children:"复制 otpauth URL"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"text-sm text-foreground font-medium",children:"步骤 2：输入应用生成的 6 位动态码"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(l.I,{value:j,onChange:e=>w(e.target.value.replace(/[^0-9]/g,"").slice(0,6)),placeholder:"123456",className:"max-w-[160px] text-center text-lg tracking-[0.4em]"}),(0,a.jsx)(o.z,{onClick:C,disabled:v,children:"验证并开启"})]})]})]}),(null==r?void 0:r.enabled)&&(0,a.jsx)(o.z,{variant:"destructive",onClick:E,disabled:v,children:"关闭多因素认证"})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-semibold text-foreground",children:"恢复代码"}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:"当无法访问 TOTP 应用时，可使用恢复代码登录。每个代码仅能使用一次。"})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-border/60 bg-background/70 p-4 text-sm",children:[(null==r?void 0:null===(e=r.recovery_codes)||void 0===e?void 0:e.length)?(0,a.jsx)("div",{className:"grid gap-2 text-center font-mono text-sm",children:(y?r.recovery_codes:r.recovery_codes.map(()=>"••••-••••")).map((e,t)=>(0,a.jsx)("span",{children:e},t))}):(0,a.jsx)("div",{className:"text-muted-foreground text-sm",children:"启用 MFA 后将会生成恢复码。"}),(null==r?void 0:null===(t=r.recovery_codes)||void 0===t?void 0:t.length)&&(0,a.jsxs)("div",{className:"mt-3 flex gap-2",children:[(0,a.jsx)(o.z,{variant:"outline",size:"sm",onClick:()=>_(e=>!e),children:y?"隐藏":"显示"}),(0,a.jsx)(o.z,{variant:"outline",size:"sm",onClick:()=>P((r.recovery_codes||[]).join("\n"),"恢复代码"),children:"导出"})]})]})]})]})]}),(0,a.jsxs)(i.Zb,{children:[(0,a.jsxs)(i.Ol,{className:"flex flex-col gap-2 md:flex-row md:items-end md:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(i.ll,{children:"活跃会话"}),(0,a.jsx)(i.SZ,{children:"监控所有已登录的设备、浏览器和 IP 地址，及时锁定可疑登录"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(o.z,{variant:"outline",size:"sm",onClick:k,disabled:g,children:g?"加载中...":"刷新"}),(0,a.jsx)(o.z,{variant:"destructive",size:"sm",onClick:D,children:"退出其他会话"})]})]}),(0,a.jsx)(i.aY,{children:(0,a.jsx)("div",{className:"rounded-xl border border-border/60 bg-background/70",children:(0,a.jsxs)(d.iA,{children:[(0,a.jsx)(d.xD,{children:(0,a.jsxs)(d.SC,{children:[(0,a.jsx)(d.ss,{className:"w-[160px]",children:"创建时间"}),(0,a.jsx)(d.ss,{className:"w-[160px]",children:"最近活动"}),(0,a.jsx)(d.ss,{children:"设备 / 浏览器"}),(0,a.jsx)(d.ss,{className:"w-[180px]",children:"IP / 位置"}),(0,a.jsx)(d.ss,{className:"w-[120px]",children:"操作"})]})}),(0,a.jsxs)(d.RM,{children:[h.map(e=>(0,a.jsxs)(d.SC,{className:e.current?"bg-primary/5":void 0,children:[(0,a.jsx)(d.pj,{className:"text-xs text-muted-foreground",children:new Date(1e3*e.created_at).toLocaleString()}),(0,a.jsx)(d.pj,{className:"text-xs text-muted-foreground",children:new Date(1e3*e.last_seen_at).toLocaleString()}),(0,a.jsxs)(d.pj,{children:[(0,a.jsx)("div",{className:"text-sm text-foreground",children:e.user_agent||"未知设备"}),e.current&&(0,a.jsx)("div",{className:"text-xs text-emerald-600",children:"当前设备"})]}),(0,a.jsxs)(d.pj,{children:[(0,a.jsx)("div",{className:"text-sm text-foreground",children:e.ip||"-"}),e.location&&(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:e.location})]}),(0,a.jsxs)(d.pj,{children:[!e.current&&(0,a.jsx)(o.z,{variant:"outline",size:"sm",onClick:()=>z(e.id),children:"退出"}),e.current&&(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"当前会话"})]})]},e.id)),!h.length&&!g&&(0,a.jsx)(d.SC,{children:(0,a.jsx)(d.pj,{colSpan:5,className:"py-8 text-center text-sm text-muted-foreground",children:"暂无会话记录。"})}),g&&(0,a.jsx)(d.SC,{children:(0,a.jsx)(d.pj,{colSpan:5,className:"py-8 text-center text-sm text-muted-foreground",children:"正在加载..."})})]})]})})})]})]})}},495:function(e,t,r){"use strict";r.d(t,{z:function(){return l}});var a=r(7437);r(2265);var s=r(1538),n=r(3027),i=r(7440);let o=(0,n.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function l(e){let{className:t,variant:r,size:n,asChild:l=!1,...d}=e,c=l?s.g7:"button";return(0,a.jsx)(c,{"data-slot":"button",className:(0,i.cn)(o({variant:r,size:n,className:t})),...d})}},6013:function(e,t,r){"use strict";r.d(t,{Ol:function(){return i},SZ:function(){return l},Zb:function(){return n},aY:function(){return d},ll:function(){return o}});var a=r(7437);r(2265);var s=r(7440);function n(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card",className:(0,s.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...r})}function i(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,s.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...r})}function o(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,s.cn)("leading-none font-semibold",t),...r})}function l(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,s.cn)("text-muted-foreground text-sm",t),...r})}function d(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,s.cn)("px-6",t),...r})}},3102:function(e,t,r){"use strict";r.d(t,{I:function(){return n}});var a=r(7437);r(2265);var s=r(7440);function n(e){let{className:t,type:r,...n}=e;return(0,a.jsx)("input",{type:r,"data-slot":"input",className:(0,s.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...n})}},6975:function(e,t,r){"use strict";r.d(t,{RM:function(){return o},SC:function(){return l},iA:function(){return n},pj:function(){return c},ss:function(){return d},xD:function(){return i}});var a=r(7437);r(2265);var s=r(7440);function n(e){let{className:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,a.jsx)("table",{"data-slot":"table",className:(0,s.cn)("w-full caption-bottom text-sm",t),...r})})}function i(e){let{className:t,...r}=e;return(0,a.jsx)("thead",{"data-slot":"table-header",className:(0,s.cn)("[&_tr]:border-b",t),...r})}function o(e){let{className:t,...r}=e;return(0,a.jsx)("tbody",{"data-slot":"table-body",className:(0,s.cn)("[&_tr:last-child]:border-0",t),...r})}function l(e){let{className:t,...r}=e;return(0,a.jsx)("tr",{"data-slot":"table-row",className:(0,s.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...r})}function d(e){let{className:t,...r}=e;return(0,a.jsx)("th",{"data-slot":"table-head",className:(0,s.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...r})}function c(e){let{className:t,...r}=e;return(0,a.jsx)("td",{"data-slot":"table-cell",className:(0,s.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...r})}},7440:function(e,t,r){"use strict";r.d(t,{cn:function(){return n}});var a=r(4839),s=r(6164);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,a.W)(t))}}},function(e){e.O(0,[247,776,648,971,23,744],function(){return e(e.s=8225)}),_N_E=e.O()}]);