(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[427],{8776:function(e,t,n){Promise.resolve().then(n.bind(n,6677))},6677:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return m}});var a=n(7437),s=n(2265),r=n(7651),l=n(6013),i=n(495),o=n(6975),d=n(7776);let c={total_users:1843,active_users_7d:612,total_clients:62,logins_today:214,mfa_enabled:388,pending_clients:4,login_success_rate:.948},u=[{label:"Mon",value:180},{label:"Tue",value:220},{label:"Wed",value:260},{label:"Thu",value:240},{label:"Fri",value:310},{label:"Sat",value:160},{label:"Sun",value:150}],x=[{client_id:"dashboard-app",name:"管理后台",weekly_logins:680,approval_status:"approved"},{client_id:"sales-portal",name:"销售门户",weekly_logins:420,approval_status:"approved"},{client_id:"partner-api",name:"合作伙伴 API",weekly_logins:320,approval_status:"pending"}];function m(){let{me:e}=(0,r.a)(),[t,n]=(0,s.useState)(null),[m,g]=(0,s.useState)([]),[p,v]=(0,s.useState)([]),[b,j]=(0,s.useState)(!1),_=!!(null==e?void 0:e.is_admin),y=(0,s.useCallback)(async()=>{j(!0);try{var e,t,a,s,r,l,i,o,m,h;let d=await fetch("/api/admin/metrics",{credentials:"include"});if(!d.ok)throw Error(await d.text());let c=await d.json();n({total_users:Number(null!==(e=c.total_users)&&void 0!==e?e:0),active_users_7d:Number(null!==(a=null!==(t=c.active_users_7d)&&void 0!==t?t:c.active_users)&&void 0!==a?a:0),total_clients:Number(null!==(s=c.total_clients)&&void 0!==s?s:0),logins_today:Number(null!==(l=null!==(r=c.logins_today)&&void 0!==r?r:c.logins_24h)&&void 0!==l?l:0),mfa_enabled:Number(null!==(o=null!==(i=c.mfa_enabled)&&void 0!==i?i:c.users_with_mfa)&&void 0!==o?o:0),pending_clients:Number(null!==(m=c.pending_clients)&&void 0!==m?m:0),login_success_rate:Number(null!==(h=c.login_success_rate)&&void 0!==h?h:0)}),g(Array.isArray(c.daily_logins)?c.daily_logins:Array.isArray(c.trend)?c.trend:u),v(Array.isArray(c.top_clients)?c.top_clients:x)}catch(e){d.Am.error((null==e?void 0:e.message)||"无法获取指标，展示示例数据"),n(c),g(u),v(x)}finally{j(!1)}},[]);(0,s.useEffect)(()=>{_&&y()},[_,y]);let N=(0,s.useMemo)(()=>Math.max(...m.length?m.map(e=>e.value):[1]),[m]);return _?(0,a.jsx)("div",{className:"container py-10 space-y-6",children:(0,a.jsxs)(l.Zb,{children:[(0,a.jsxs)(l.Ol,{className:"flex flex-col gap-3 md:flex-row md:items-end md:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(l.ll,{children:"平台运行概览"}),(0,a.jsx)(l.SZ,{children:"实时掌握用户增长、登录情况、客户端审批及 MFA 启用情况"})]}),(0,a.jsx)(i.z,{variant:"outline",size:"sm",onClick:y,disabled:b,children:b?"刷新中...":"刷新"})]}),t&&(0,a.jsxs)(l.aY,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-3 lg:grid-cols-6",children:[(0,a.jsx)(h,{title:"用户总数",value:t.total_users.toLocaleString()}),(0,a.jsx)(h,{title:"7 日活跃",value:t.active_users_7d.toLocaleString()}),(0,a.jsx)(h,{title:"应用数量",value:t.total_clients.toLocaleString()}),(0,a.jsx)(h,{title:"今日登录",value:t.logins_today.toLocaleString()}),(0,a.jsx)(h,{title:"启用 MFA",value:t.mfa_enabled.toLocaleString()}),(0,a.jsx)(h,{title:"登录成功率",value:"".concat(Math.round(100*t.login_success_rate),"%"),highlight:t.login_success_rate<.9?"warning":void 0})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-foreground",children:"过去 7 天登录趋势"}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"成功登录次数统计"})]}),(0,a.jsx)("div",{className:"flex gap-4",children:m.map(e=>(0,a.jsxs)("div",{className:"flex flex-1 flex-col items-center gap-2",children:[(0,a.jsx)("div",{className:"w-full rounded-lg bg-gradient-to-t from-primary/10 via-primary/50 to-primary",style:{height:"".concat(Math.max(e.value/N*180,12),"px")},title:"".concat(e.label,": ").concat(e.value)}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:e.label})]},e.label))})]}),(0,a.jsxs)("div",{className:"grid gap-4 lg:grid-cols-2",children:[(0,a.jsxs)("div",{className:"rounded-xl border border-border/60 bg-background/70 p-4",children:[(0,a.jsx)("div",{className:"text-sm font-semibold text-foreground",children:"待办事项"}),(0,a.jsxs)("div",{className:"mt-3 space-y-3 text-sm",children:[(0,a.jsx)(f,{done:0===t.pending_clients,text:"待审批客户端 ".concat(t.pending_clients," 个")}),(0,a.jsx)(f,{done:t.login_success_rate>.9,text:"登录成功率 ≥ 90%"}),(0,a.jsx)(f,{done:t.mfa_enabled/Math.max(t.total_users,1)>.3,text:"至少 30% 用户启用 MFA"})]})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-border/60 bg-background/70 p-4",children:[(0,a.jsx)("div",{className:"text-sm font-semibold text-foreground",children:"策略提醒"}),(0,a.jsxs)("ul",{className:"mt-3 list-disc space-y-2 pl-5 text-sm text-muted-foreground",children:[(0,a.jsx)("li",{children:"建议启用“强制新用户绑定 MFA”策略"}),(0,a.jsx)("li",{children:"建议将 Token 默认有效期从 7200s 减少至 3600s"}),(0,a.jsx)("li",{children:"考虑为销售门户配置基于 IP 的访问限制"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-foreground",children:"高活跃客户端"}),(0,a.jsx)("a",{className:"text-xs text-primary",href:"/admin/approvals",children:"管理客户端审批"})]}),(0,a.jsx)("div",{className:"rounded-xl border border-border/60 bg-background/70",children:(0,a.jsxs)(o.iA,{children:[(0,a.jsx)(o.xD,{children:(0,a.jsxs)(o.SC,{children:[(0,a.jsx)(o.ss,{children:"客户端"}),(0,a.jsx)(o.ss,{children:"近 7 天登录"}),(0,a.jsx)(o.ss,{children:"审批状态"})]})}),(0,a.jsx)(o.RM,{children:p.map(e=>(0,a.jsxs)(o.SC,{children:[(0,a.jsxs)(o.pj,{children:[(0,a.jsx)("div",{className:"text-sm text-foreground font-medium",children:e.name||e.client_id}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:e.client_id})]}),(0,a.jsx)(o.pj,{className:"text-sm text-muted-foreground",children:e.weekly_logins.toLocaleString()}),(0,a.jsx)(o.pj,{children:(0,a.jsx)("span",{className:"rounded-full px-2 py-0.5 text-xs font-medium ".concat("approved"===e.approval_status?"bg-emerald-500/10 text-emerald-600":"pending"===e.approval_status?"bg-amber-500/10 text-amber-600":"bg-slate-500/10 text-slate-600"),children:"approved"===e.approval_status?"已批准":"pending"===e.approval_status?"待审批":e.approval_status})})]},e.client_id))})]})})]})]})]})}):(0,a.jsx)("div",{className:"container py-10",children:(0,a.jsxs)(l.Zb,{children:[(0,a.jsxs)(l.Ol,{children:[(0,a.jsx)(l.ll,{children:"全局仪表盘"}),(0,a.jsx)(l.SZ,{children:"需要管理员权限"})]}),(0,a.jsx)(l.aY,{children:(0,a.jsx)("a",{className:"btn",href:"/login?next=".concat(encodeURIComponent("/admin/dashboard")),children:"管理员登录"})})]})})}function h(e){let{title:t,value:n,highlight:s}=e;return(0,a.jsxs)("div",{className:"rounded-xl border border-border/60 bg-background/70 p-4 ".concat("warning"===s?"border-amber-500/60":""),children:[(0,a.jsx)("div",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:t}),(0,a.jsx)("div",{className:"mt-2 text-2xl font-semibold text-foreground",children:n})]})}function f(e){let{done:t,text:n}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("span",{className:"h-2.5 w-2.5 rounded-full ".concat(t?"bg-emerald-500":"bg-amber-500"),"aria-hidden":!0}),(0,a.jsx)("span",{className:t?"text-muted-foreground":"text-foreground",children:n})]})}},495:function(e,t,n){"use strict";n.d(t,{z:function(){return o}});var a=n(7437);n(2265);var s=n(1538),r=n(3027),l=n(7440);let i=(0,r.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function o(e){let{className:t,variant:n,size:r,asChild:o=!1,...d}=e,c=o?s.g7:"button";return(0,a.jsx)(c,{"data-slot":"button",className:(0,l.cn)(i({variant:n,size:r,className:t})),...d})}},6013:function(e,t,n){"use strict";n.d(t,{Ol:function(){return l},SZ:function(){return o},Zb:function(){return r},aY:function(){return d},ll:function(){return i}});var a=n(7437);n(2265);var s=n(7440);function r(e){let{className:t,...n}=e;return(0,a.jsx)("div",{"data-slot":"card",className:(0,s.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...n})}function l(e){let{className:t,...n}=e;return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,s.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...n})}function i(e){let{className:t,...n}=e;return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,s.cn)("leading-none font-semibold",t),...n})}function o(e){let{className:t,...n}=e;return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,s.cn)("text-muted-foreground text-sm",t),...n})}function d(e){let{className:t,...n}=e;return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,s.cn)("px-6",t),...n})}},6975:function(e,t,n){"use strict";n.d(t,{RM:function(){return i},SC:function(){return o},iA:function(){return r},pj:function(){return c},ss:function(){return d},xD:function(){return l}});var a=n(7437);n(2265);var s=n(7440);function r(e){let{className:t,...n}=e;return(0,a.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,a.jsx)("table",{"data-slot":"table",className:(0,s.cn)("w-full caption-bottom text-sm",t),...n})})}function l(e){let{className:t,...n}=e;return(0,a.jsx)("thead",{"data-slot":"table-header",className:(0,s.cn)("[&_tr]:border-b",t),...n})}function i(e){let{className:t,...n}=e;return(0,a.jsx)("tbody",{"data-slot":"table-body",className:(0,s.cn)("[&_tr:last-child]:border-0",t),...n})}function o(e){let{className:t,...n}=e;return(0,a.jsx)("tr",{"data-slot":"table-row",className:(0,s.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...n})}function d(e){let{className:t,...n}=e;return(0,a.jsx)("th",{"data-slot":"table-head",className:(0,s.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...n})}function c(e){let{className:t,...n}=e;return(0,a.jsx)("td",{"data-slot":"table-cell",className:(0,s.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...n})}},6264:function(e,t,n){"use strict";async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={credentials:"include",headers:{Accept:"application/json",...t.headers||{}},...t},a=await fetch(e,n);if(401===a.status){let e=encodeURIComponent(window.location.pathname+window.location.search);throw window.location.href="/login?next=".concat(e),Error("unauthorized")}let s=await a.text(),r=a.headers.get("Content-Type")||"",l=s;if(r.includes("application/json"))try{l=JSON.parse(s)}catch(e){}if(!a.ok){let e=l&&(l.error||l.message)||a.statusText;throw Error("string"==typeof e?e:JSON.stringify(l))}return l}async function s(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return a(e,{method:n.method||"POST",headers:{"Content-Type":"application/json",...n.headers||{}},body:JSON.stringify(t)})}n.d(t,{h:function(){return a},j:function(){return s}})},7651:function(e,t,n){"use strict";n.d(t,{H:function(){return i},a:function(){return o}});var a=n(7437),s=n(2265),r=n(6264);let l=(0,s.createContext)(null);function i(e){let{children:t}=e,[n,i]=(0,s.useState)(null),[o,d]=(0,s.useState)(!0),c=async()=>{try{let e=await (0,r.h)("/api/me");i(e)}catch(e){i(null)}finally{d(!1)}};(0,s.useEffect)(()=>{c()},[]);let u=async()=>{await fetch("/logout",{credentials:"include"}),window.location.href="/"},x=(0,s.useMemo)(()=>({me:n,loading:o,refresh:c,logout:u}),[n,o]);return(0,a.jsx)(l.Provider,{value:x,children:t})}function o(){return(0,s.useContext)(l)||{me:null,loading:!0,refresh:async()=>{},logout:async()=>{}}}},7440:function(e,t,n){"use strict";n.d(t,{cn:function(){return r}});var a=n(4839),s=n(6164);function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,s.m6)((0,a.W)(t))}}},function(e){e.O(0,[247,776,971,23,744],function(){return e(e.s=8776)}),_N_E=e.O()}]);