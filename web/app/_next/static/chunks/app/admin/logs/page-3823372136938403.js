(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[757],{3927:function(e,t,a){Promise.resolve().then(a.bind(a,1705))},1705:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var r=a(7437),n=a(2265),s=a(6013),l=a(3102),o=a(495),i=a(6201);function c(){let[e,t]=(0,n.useState)([]),[a,c]=(0,n.useState)(""),[d,u]=(0,n.useState)(""),[x,h]=(0,n.useState)(""),[g,m]=(0,n.useState)(""),[v,f]=(0,n.useState)(""),[p,b]=(0,n.useState)(""),[j,w]=(0,n.useState)(""),[N,y]=(0,n.useState)(""),[C,S]=(0,n.useState)(""),[k,_]=(0,n.useState)(""),[I,K]=(0,n.useState)(""),P=(0,n.useCallback)(async()=>{let e=new URLSearchParams;a&&e.set("level",a),d&&e.set("event",d),x&&e.set("user",x),g&&e.set("client",g),v&&e.set("request_id",v),p&&e.set("outcome",p),j&&e.set("error_code",j),N&&e.set("method",N),C&&e.set("path",C),k&&e.set("ua",k),I&&e.set("status",I);let r=await fetch("/api/logs?".concat(e.toString()),{credentials:"include"});if(!r.ok){alert("加载失败");return}t(await r.json())},[a,d,x,g,v,p,j,N,C,k,I]);return(0,n.useEffect)(()=>{P()},[P]),(0,r.jsxs)(s.Zb,{className:"w-full max-w-5xl mx-auto mt-8 p-4",children:[(0,r.jsx)("h2",{className:"text-xl font-bold mb-4",children:"审计日志"}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2 mb-3",children:[(0,r.jsx)(l.I,{placeholder:"级别",value:a,onChange:e=>c(e.target.value),className:"w-28"}),(0,r.jsx)(l.I,{placeholder:"事件",value:d,onChange:e=>u(e.target.value),className:"w-44"}),(0,r.jsx)(l.I,{placeholder:"用户ID",value:x,onChange:e=>h(e.target.value),className:"w-28"}),(0,r.jsx)(l.I,{placeholder:"客户端ID",value:g,onChange:e=>m(e.target.value),className:"w-44"}),(0,r.jsx)(l.I,{placeholder:"request_id",value:v,onChange:e=>f(e.target.value),className:"w-48"}),(0,r.jsx)(l.I,{placeholder:"outcome",value:p,onChange:e=>b(e.target.value),className:"w-32"}),(0,r.jsx)(l.I,{placeholder:"error_code",value:j,onChange:e=>w(e.target.value),className:"w-40"}),(0,r.jsx)(l.I,{placeholder:"method",value:N,onChange:e=>y(e.target.value),className:"w-24"}),(0,r.jsx)(l.I,{placeholder:"path",value:C,onChange:e=>S(e.target.value),className:"w-56"}),(0,r.jsx)(l.I,{placeholder:"UA",value:k,onChange:e=>_(e.target.value),className:"w-64"}),(0,r.jsx)(l.I,{placeholder:"status",value:I,onChange:e=>K(e.target.value),className:"w-24"}),(0,r.jsx)(o.z,{onClick:P,children:"查询"})]}),(0,r.jsx)(i.w,{columns:[{header:"时间",accessorKey:"ts",cell:e=>{let{getValue:t}=e;return new Date(1e3*(t()||0)).toLocaleString()}},{header:"级别",accessorKey:"level"},{header:"事件",accessorKey:"event"},{header:"request_id",accessorKey:"request_id",cell:e=>{let{row:t}=e;return t.original.request_id?(0,r.jsx)("button",{className:"underline text-blue-600 hover:text-blue-800",onClick:()=>navigator.clipboard.writeText(t.original.request_id),title:"点击复制",children:t.original.request_id}):""}},{header:"outcome",accessorKey:"outcome"},{header:"error_code",accessorKey:"error_code"},{header:"method",accessorKey:"method"},{header:"path",accessorKey:"path",cell:e=>{var t;let{row:a}=e;return(0,r.jsx)("span",{className:"max-w-[260px] truncate inline-block",title:a.original.path,children:null!==(t=a.original.path)&&void 0!==t?t:""})}},{header:"status",accessorKey:"status"},{header:"UA",accessorKey:"ua",cell:e=>{var t;let{row:a}=e;return(0,r.jsx)("span",{className:"max-w-[260px] truncate inline-block",title:a.original.ua,children:null!==(t=a.original.ua)&&void 0!==t?t:""})}},{header:"用户",accessorKey:"user_id"},{header:"客户端",accessorKey:"client_id"},{header:"描述",accessorKey:"desc",cell:e=>{let{row:t}=e;return(0,r.jsx)("span",{className:"max-w-[320px] truncate inline-block",title:t.original.desc,children:t.original.desc})}},{header:"Extra",accessorKey:"extra",cell:e=>{let{row:t}=e,a=t.original;try{let e="string"==typeof a.extra?JSON.parse(a.extra):a.extra,t=(null==e?void 0:e.required)?"req:".concat(Array.isArray(e.required)?e.required.join("|"):e.required):"",n=(null==e?void 0:e.session_acr)?"acr:".concat(e.session_acr):"",s=(null==e?void 0:e.min_acr)?"min:".concat(e.min_acr):"",l=[t,n,s].filter(Boolean),o=l.length?l.join(" "):"";return(0,r.jsx)("span",{className:"max-w-[320px] text-xs text-slate-400 truncate inline-block",title:JSON.stringify(a.extra),children:o})}catch(e){return(0,r.jsx)("span",{className:"text-xs text-slate-400"})}}},{header:"IP",accessorKey:"ip"}],data:e,rowKey:(e,t)=>"".concat(e.ts,"-").concat(t),searchable:!0,searchPlaceholder:"搜索事件/路径/UA/描述"})]})}},495:function(e,t,a){"use strict";a.d(t,{z:function(){return i}});var r=a(7437);a(2265);var n=a(1538),s=a(3027),l=a(7440);let o=(0,s.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function i(e){let{className:t,variant:a,size:s,asChild:i=!1,...c}=e,d=i?n.g7:"button";return(0,r.jsx)(d,{"data-slot":"button",className:(0,l.cn)(o({variant:a,size:s,className:t})),...c})}},6013:function(e,t,a){"use strict";a.d(t,{Ol:function(){return l},SZ:function(){return i},Zb:function(){return s},aY:function(){return c},ll:function(){return o}});var r=a(7437);a(2265);var n=a(7440);function s(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card",className:(0,n.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...a})}function l(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:(0,n.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function o(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-title",className:(0,n.cn)("leading-none font-semibold",t),...a})}function i(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-description",className:(0,n.cn)("text-muted-foreground text-sm",t),...a})}function c(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:(0,n.cn)("px-6",t),...a})}},6201:function(e,t,a){"use strict";a.d(t,{w:function(){return d}});var r=a(7437),n=a(2265),s=a(3514),l=a(4175),o=a(6975),i=a(3102),c=a(495);function d(e){var t;let{columns:a,data:d,rowKey:u,pageSize:x=10,searchable:h=!1,searchPlaceholder:g="搜索...",toolbarRender:m,loading:v}=e,[f,p]=n.useState([]),[b,j]=n.useState(""),w=(0,s.b7)({data:d,columns:a,state:{sorting:f,globalFilter:b},onSortingChange:p,onGlobalFilterChange:j,getCoreRowModel:(0,l.sC)(),getFilteredRowModel:(0,l.vL)(),getSortedRowModel:(0,l.tj)(),getPaginationRowModel:(0,l.G_)()});n.useEffect(()=>{w.setPageSize(x)},[x,w]);let N=(0,n.useMemo)(()=>u||((e,t)=>{var a;return null!==(a=null==e?void 0:e.id)&&void 0!==a?a:t}),[u]);return(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,r.jsx)("div",{className:"flex items-center gap-2",children:h&&(0,r.jsx)(i.I,{value:null!=b?b:"",placeholder:g,onChange:e=>j(e.target.value),className:"w-64"})}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:m})]}),(0,r.jsx)("div",{className:"overflow-x-auto border rounded-md",children:(0,r.jsxs)(o.iA,{children:[(0,r.jsx)(o.xD,{children:w.getHeaderGroups().map(e=>(0,r.jsx)(o.SC,{children:e.headers.map(e=>{var t;return(0,r.jsx)(o.ss,{className:"whitespace-nowrap select-none",children:e.isPlaceholder?null:(0,r.jsxs)("div",{className:e.column.getCanSort()?"cursor-pointer select-none":"",onClick:e.column.getToggleSortingHandler(),children:[(0,s.ie)(e.column.columnDef.header,e.getContext()),null!==(t=({asc:" ▲",desc:" ▼"})[e.column.getIsSorted()])&&void 0!==t?t:null]})},e.id)})},e.id))}),(0,r.jsx)(o.RM,{children:v?(0,r.jsx)(o.SC,{children:(0,r.jsx)(o.pj,{colSpan:a.length,children:(0,r.jsx)("div",{className:"py-8 text-center text-sm text-muted-foreground",children:"加载中..."})})}):(null===(t=w.getRowModel().rows)||void 0===t?void 0:t.length)?w.getRowModel().rows.map((e,t)=>(0,r.jsx)(o.SC,{children:e.getVisibleCells().map(e=>(0,r.jsx)(o.pj,{children:(0,s.ie)(e.column.columnDef.cell,e.getContext())},e.id))},N(e.original,t))):(0,r.jsx)(o.SC,{children:(0,r.jsx)(o.pj,{colSpan:a.length,children:(0,r.jsx)("div",{className:"py-8 text-center text-sm text-muted-foreground",children:"暂无数据"})})})})]})}),(0,r.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,r.jsxs)("div",{className:"text-sm text-muted-foreground mr-auto",children:["共 ",d.length," 条，页 ",w.getState().pagination.pageIndex+1," / ",w.getPageCount()||1]}),(0,r.jsx)(c.z,{variant:"outline",size:"sm",onClick:()=>w.previousPage(),disabled:!w.getCanPreviousPage(),children:"上一页"}),(0,r.jsx)(c.z,{variant:"outline",size:"sm",onClick:()=>w.nextPage(),disabled:!w.getCanNextPage(),children:"下一页"})]})]})}},3102:function(e,t,a){"use strict";a.d(t,{I:function(){return s}});var r=a(7437);a(2265);var n=a(7440);function s(e){let{className:t,type:a,...s}=e;return(0,r.jsx)("input",{type:a,"data-slot":"input",className:(0,n.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...s})}},6975:function(e,t,a){"use strict";a.d(t,{RM:function(){return o},SC:function(){return i},iA:function(){return s},pj:function(){return d},ss:function(){return c},xD:function(){return l}});var r=a(7437);a(2265);var n=a(7440);function s(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,r.jsx)("table",{"data-slot":"table",className:(0,n.cn)("w-full caption-bottom text-sm",t),...a})})}function l(e){let{className:t,...a}=e;return(0,r.jsx)("thead",{"data-slot":"table-header",className:(0,n.cn)("[&_tr]:border-b",t),...a})}function o(e){let{className:t,...a}=e;return(0,r.jsx)("tbody",{"data-slot":"table-body",className:(0,n.cn)("[&_tr:last-child]:border-0",t),...a})}function i(e){let{className:t,...a}=e;return(0,r.jsx)("tr",{"data-slot":"table-row",className:(0,n.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...a})}function c(e){let{className:t,...a}=e;return(0,r.jsx)("th",{"data-slot":"table-head",className:(0,n.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function d(e){let{className:t,...a}=e;return(0,r.jsx)("td",{"data-slot":"table-cell",className:(0,n.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}},7440:function(e,t,a){"use strict";a.d(t,{cn:function(){return s}});var r=a(4839),n=a(6164);function s(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,n.m6)((0,r.W)(t))}}},function(e){e.O(0,[247,514,971,23,744],function(){return e(e.s=3927)}),_N_E=e.O()}]);