(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[235],{8890:function(e,r,t){Promise.resolve().then(t.bind(t,7386))},7386:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return f}});var n=t(7437),a=t(2265),i=t(6648),s=t(7651),o=t(6013),l=t(495),d=t(3102),c=t(7135),u=t(7776);let g={primary_color:"#6366F1",accent_color:"#10B981",background_color:"#F6F7FB",email_subject:"欢迎加入 GinkgoID 平台",email_body:"您好 {{user.name}}，欢迎使用 GinkgoID。点击下方按钮完成设置。"};function f(){var e;let{me:r}=(0,s.a)(),t=!!(null==r?void 0:r.is_admin),[f,h]=(0,a.useState)(g),[m,p]=(0,a.useState)(null),[x,v]=(0,a.useState)(null),[b,j]=(0,a.useState)(!1);(0,a.useEffect)(()=>{t&&(async()=>{try{let e=await fetch("/api/admin/branding",{credentials:"include"});if(!e.ok)throw Error(await e.text());let r=await e.json();h({...g,...r}),p(r.logo_url||null),v(r.dark_mode_logo_url||null)}catch(e){u.Am.error((null==e?void 0:e.message)||"无法加载品牌配置，展示示例数据")}})()},[t]);let y=(e,r,t)=>{let n=new FileReader;n.onload=()=>{let e=n.result;r(e),h(r=>({...r,[t]:e}))},n.readAsDataURL(e)},w=async()=>{j(!0);try{let e=await fetch("/api/admin/branding",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(f)});if(!e.ok)throw Error(await e.text());u.Am.success("品牌设置已保存")}catch(e){u.Am.error((null==e?void 0:e.message)||"保存失败 (后端可能未实现) ")}finally{j(!1)}};return t?(0,n.jsxs)("div",{className:"container py-10 space-y-6",children:[(0,n.jsxs)(o.Zb,{children:[(0,n.jsxs)(o.Ol,{children:[(0,n.jsx)(o.ll,{children:"主题色与 Logo"}),(0,n.jsx)(o.SZ,{children:"定制控制台的品牌色和 Logo，所有终端用户与开发者入口将应用该配置"})]}),(0,n.jsxs)(o.aY,{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,n.jsxs)("div",{className:"grid gap-2",children:[(0,n.jsx)(c._,{children:"主色 (按钮/高亮)"}),(0,n.jsx)(d.I,{type:"color",value:f.primary_color,onChange:e=>h({...f,primary_color:e.target.value})})]}),(0,n.jsxs)("div",{className:"grid gap-2",children:[(0,n.jsx)(c._,{children:"强调色 (成功/状态)"}),(0,n.jsx)(d.I,{type:"color",value:f.accent_color,onChange:e=>h({...f,accent_color:e.target.value})})]}),(0,n.jsxs)("div",{className:"grid gap-2",children:[(0,n.jsx)(c._,{children:"背景色"}),(0,n.jsx)(d.I,{type:"color",value:f.background_color,onChange:e=>h({...f,background_color:e.target.value})})]})]}),(0,n.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(c._,{children:"浅色模式 Logo"}),(0,n.jsx)(d.I,{type:"file",accept:"image/png,image/svg+xml",onChange:e=>{var r;let t=null===(r=e.target.files)||void 0===r?void 0:r[0];t&&y(t,p,"logo_url")}}),m&&(0,n.jsx)(i.default,{src:m,alt:"Light Logo",className:"h-16 w-auto rounded border",height:64,width:200,unoptimized:!0})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(c._,{children:"深色模式 Logo"}),(0,n.jsx)(d.I,{type:"file",accept:"image/png,image/svg+xml",onChange:e=>{var r;let t=null===(r=e.target.files)||void 0===r?void 0:r[0];t&&y(t,v,"dark_mode_logo_url")}}),x&&(0,n.jsx)(i.default,{src:x,alt:"Dark Logo",className:"h-16 w-auto rounded border bg-slate-900 p-2",height:64,width:200,unoptimized:!0})]})]})]})]}),(0,n.jsxs)(o.Zb,{children:[(0,n.jsxs)(o.Ol,{children:[(0,n.jsx)(o.ll,{children:"邮件模板"}),(0,n.jsx)(o.SZ,{children:"自定义平台发送的欢迎邮件、密码重置邮件等模板内容，支持 Handlebars 变量"})]}),(0,n.jsxs)(o.aY,{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"grid gap-2",children:[(0,n.jsx)(c._,{children:"默认主题"}),(0,n.jsx)(d.I,{value:f.email_subject,onChange:e=>h({...f,email_subject:e.target.value})})]}),(0,n.jsxs)("div",{className:"grid gap-2",children:[(0,n.jsx)(c._,{children:"正文"}),(0,n.jsx)("textarea",{value:f.email_body,onChange:e=>h({...f,email_body:e.target.value}),className:"min-h-[180px] w-full rounded-md border border-border bg-background px-3 py-2 text-sm leading-relaxed",placeholder:"使用 {{user.name}}、{{action_url}} 等变量"})]}),(0,n.jsxs)("div",{className:"rounded-xl border border-border/60 bg-muted/30 p-4 text-sm",children:[(0,n.jsx)("div",{className:"text-xs uppercase text-muted-foreground",children:"实时预览"}),(0,n.jsxs)("div",{className:"mt-2 rounded-md border border-border bg-white p-4 text-sm text-slate-800",style:{borderTopColor:f.primary_color,borderTopWidth:3},children:[(0,n.jsx)("div",{className:"text-lg font-semibold",style:{color:f.primary_color},children:f.email_subject}),(0,n.jsx)("p",{className:"mt-3 whitespace-pre-line",children:null===(e=f.email_body)||void 0===e?void 0:e.replace(/\{\{user.name\}\}/g,"张三").replace(/\{\{action_url\}\}/g,"https://example.com/verify")}),(0,n.jsx)(l.z,{className:"mt-4",style:{backgroundColor:f.primary_color},children:"前往设置"})]})]})]})]}),(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)(l.z,{onClick:w,disabled:b,children:b?"保存中...":"保存品牌配置"})})]}):(0,n.jsx)("div",{className:"container py-10",children:(0,n.jsxs)(o.Zb,{children:[(0,n.jsxs)(o.Ol,{children:[(0,n.jsx)(o.ll,{children:"品牌与外观"}),(0,n.jsx)(o.SZ,{children:"需要管理员权限"})]}),(0,n.jsx)(o.aY,{children:(0,n.jsx)("a",{className:"btn",href:"/login?next=".concat(encodeURIComponent("/admin/branding")),children:"管理员登录"})})]})})}},495:function(e,r,t){"use strict";t.d(r,{z:function(){return l}});var n=t(7437);t(2265);var a=t(1538),i=t(3027),s=t(7440);let o=(0,i.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function l(e){let{className:r,variant:t,size:i,asChild:l=!1,...d}=e,c=l?a.g7:"button";return(0,n.jsx)(c,{"data-slot":"button",className:(0,s.cn)(o({variant:t,size:i,className:r})),...d})}},6013:function(e,r,t){"use strict";t.d(r,{Ol:function(){return s},SZ:function(){return l},Zb:function(){return i},aY:function(){return d},ll:function(){return o}});var n=t(7437);t(2265);var a=t(7440);function i(e){let{className:r,...t}=e;return(0,n.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",r),...t})}function s(e){let{className:r,...t}=e;return(0,n.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",r),...t})}function o(e){let{className:r,...t}=e;return(0,n.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",r),...t})}function l(e){let{className:r,...t}=e;return(0,n.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",r),...t})}function d(e){let{className:r,...t}=e;return(0,n.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",r),...t})}},3102:function(e,r,t){"use strict";t.d(r,{I:function(){return i}});var n=t(7437);t(2265);var a=t(7440);function i(e){let{className:r,type:t,...i}=e;return(0,n.jsx)("input",{type:t,"data-slot":"input",className:(0,a.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",r),...i})}},7135:function(e,r,t){"use strict";t.d(r,{_:function(){return s}});var n=t(7437);t(2265);var a=t(8364),i=t(7440);function s(e){let{className:r,...t}=e;return(0,n.jsx)(a.f,{"data-slot":"label",className:(0,i.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",r),...t})}},6264:function(e,r,t){"use strict";async function n(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t={credentials:"include",headers:{Accept:"application/json",...r.headers||{}},...r},n=await fetch(e,t);if(401===n.status){let e=encodeURIComponent(window.location.pathname+window.location.search);throw window.location.href="/login?next=".concat(e),Error("unauthorized")}let a=await n.text(),i=n.headers.get("Content-Type")||"",s=a;if(i.includes("application/json"))try{s=JSON.parse(a)}catch(e){}if(!n.ok){let e=s&&(s.error||s.message)||n.statusText;throw Error("string"==typeof e?e:JSON.stringify(s))}return s}async function a(e,r){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n(e,{method:t.method||"POST",headers:{"Content-Type":"application/json",...t.headers||{}},body:JSON.stringify(r)})}t.d(r,{h:function(){return n},j:function(){return a}})},7651:function(e,r,t){"use strict";t.d(r,{H:function(){return o},a:function(){return l}});var n=t(7437),a=t(2265),i=t(6264);let s=(0,a.createContext)(null);function o(e){let{children:r}=e,[t,o]=(0,a.useState)(null),[l,d]=(0,a.useState)(!0),c=async()=>{try{let e=await (0,i.h)("/api/me");o(e)}catch(e){o(null)}finally{d(!1)}};(0,a.useEffect)(()=>{c()},[]);let u=async()=>{await fetch("/logout",{credentials:"include"}),window.location.href="/"},g=(0,a.useMemo)(()=>({me:t,loading:l,refresh:c,logout:u}),[t,l]);return(0,n.jsx)(s.Provider,{value:g,children:r})}function l(){return(0,a.useContext)(s)||{me:null,loading:!0,refresh:async()=>{},logout:async()=>{}}}},7440:function(e,r,t){"use strict";t.d(r,{cn:function(){return i}});var n=t(4839),a=t(6164);function i(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,a.m6)((0,n.W)(r))}},8364:function(e,r,t){"use strict";t.d(r,{f:function(){return o}});var n=t(2265),a=t(5171),i=t(7437),s=n.forwardRef((e,r)=>(0,i.jsx)(a.WV.label,{...e,ref:r,onMouseDown:r=>{var t;r.target.closest("button, input, select, textarea")||(null===(t=e.onMouseDown)||void 0===t||t.call(e,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));s.displayName="Label";var o=s},5171:function(e,r,t){"use strict";t.d(r,{WV:function(){return o},jH:function(){return l}});var n=t(2265),a=t(4887),i=t(1538),s=t(7437),o=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,r)=>{let t=(0,i.Z8)(`Primitive.${r}`),a=n.forwardRef((e,n)=>{let{asChild:a,...i}=e,o=a?t:r;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,s.jsx)(o,{...i,ref:n})});return a.displayName=`Primitive.${r}`,{...e,[r]:a}},{});function l(e,r){e&&a.flushSync(()=>e.dispatchEvent(r))}}},function(e){e.O(0,[247,776,648,971,23,744],function(){return e(e.s=8890)}),_N_E=e.O()}]);