(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[674],{9257:function(e,t,n){Promise.resolve().then(n.bind(n,2573))},2573:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return f}});var a=n(7437),r=n(2265),s=n(7135),i=n(3102),l=n(495),o=n(837),d=n(4421),c=n(6201),u=n(7776);function f(){let[e,t]=(0,r.useState)(!1),[n,f]=(0,r.useState)([]),[h,x]=(0,r.useState)(!1),[g,m]=(0,r.useState)(!1),[p,v]=(0,r.useState)({username:"",password:"",email:"",name:"",is_admin:!1,is_dev:!1}),[b,j]=(0,r.useState)(!1),w=async()=>{j(!0);let e=await fetch("/api/me",{credentials:"include"}).then(e=>e.json()).catch(()=>null);if(!(null==e?void 0:e.is_admin)){t(!1),j(!1);return}t(!0),f(await fetch("/api/users",{credentials:"include"}).then(e=>e.json()).catch(()=>[])),j(!1)};(0,r.useEffect)(()=>{w()},[]);let y=async()=>{m(!0);let e=await fetch("/api/users",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(p)});if(m(!1),e.ok)u.Am.success("创建成功"),v({username:"",password:"",email:"",name:"",is_admin:!1,is_dev:!1}),x(!1),await w();else{let t=await e.text();u.Am.error("创建失败: "+t)}},k=async e=>{(await fetch("/api/users/".concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({is_admin:!e.is_admin})})).ok?(u.Am.success("已更新"),await w()):u.Am.error("操作失败")},N=async e=>{(await fetch("/api/users/".concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({is_dev:!e.is_dev})})).ok?(u.Am.success("已更新"),await w()):u.Am.error("操作失败")};return e?(0,a.jsx)("div",{className:"container py-10 space-y-6",children:(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"用户列表"}),(0,a.jsxs)(o.Vq,{open:h,onOpenChange:x,children:[(0,a.jsx)(o.hg,{asChild:!0,children:(0,a.jsx)(l.z,{children:"创建用户"})}),(0,a.jsxs)(o.cZ,{children:[(0,a.jsx)(o.fK,{children:(0,a.jsx)(o.$N,{children:"创建用户"})}),(0,a.jsxs)("div",{className:"grid gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(s._,{children:"用户名"}),(0,a.jsx)(i.I,{value:p.username,onChange:e=>v({...p,username:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(s._,{children:"口令"}),(0,a.jsx)(i.I,{type:"password",value:p.password,onChange:e=>v({...p,password:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(s._,{children:"邮箱"}),(0,a.jsx)(i.I,{value:p.email,onChange:e=>v({...p,email:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(s._,{children:"姓名"}),(0,a.jsx)(i.I,{value:p.name,onChange:e=>v({...p,name:e.target.value})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(s._,{children:"管理员"}),(0,a.jsx)(d.r,{checked:p.is_admin,onCheckedChange:e=>v({...p,is_admin:e})})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(s._,{children:"开发者"}),(0,a.jsx)(d.r,{checked:p.is_dev,onCheckedChange:e=>v({...p,is_dev:e})})]}),(0,a.jsx)("div",{className:"flex justify-end gap-3 mt-2",children:(0,a.jsx)(l.z,{onClick:y,disabled:g,children:g?"创建中...":"创建"})})]})]})]})]}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(c.w,{columns:[{accessorKey:"id",header:"ID",cell:e=>{let{getValue:t}=e;return(0,a.jsx)("span",{children:t()})}},{accessorKey:"username",header:"用户名"},{accessorKey:"name",header:"姓名"},{accessorKey:"email",header:"邮箱"},{accessorKey:"is_admin",header:"管理员",cell:e=>{let{row:t}=e;return t.original.is_admin?"是":"否"}},{accessorKey:"is_dev",header:"开发者",cell:e=>{let{row:t}=e;return t.original.is_dev?"是":"否"}},{id:"actions",header:"操作",cell:e=>{let{row:t}=e,n=t.original;return(0,a.jsxs)("div",{className:"space-x-2",children:[(0,a.jsx)(l.z,{onClick:()=>k(n),variant:n.is_admin?"destructive":"default",children:n.is_admin?"取消管理员":"设为管理员"}),(0,a.jsx)(l.z,{onClick:()=>N(n),variant:n.is_dev?"destructive":"outline",children:n.is_dev?"取消开发者":"设为开发者"})]})}}],data:n,rowKey:e=>e.id,searchable:!0,searchPlaceholder:"搜索用户名/姓名/邮箱",loading:b})})]})}):(0,a.jsx)("div",{className:"container py-10",children:(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"用户管理"}),(0,a.jsx)("p",{className:"text-slate-400 mt-2",children:"需要管理员权限"}),(0,a.jsx)("div",{className:"mt-3",children:(0,a.jsx)("a",{className:"btn",href:"/login?next=".concat(encodeURIComponent("/admin/users")),children:"管理员登录"})})]})})}},495:function(e,t,n){"use strict";n.d(t,{z:function(){return o}});var a=n(7437);n(2265);var r=n(1538),s=n(3027),i=n(7440);let l=(0,s.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function o(e){let{className:t,variant:n,size:s,asChild:o=!1,...d}=e,c=o?r.g7:"button";return(0,a.jsx)(c,{"data-slot":"button",className:(0,i.cn)(l({variant:n,size:s,className:t})),...d})}},6201:function(e,t,n){"use strict";n.d(t,{w:function(){return c}});var a=n(7437),r=n(2265),s=n(3514),i=n(4175),l=n(6975),o=n(3102),d=n(495);function c(e){var t;let{columns:n,data:c,rowKey:u,pageSize:f=10,searchable:h=!1,searchPlaceholder:x="搜索...",toolbarRender:g,loading:m}=e,[p,v]=r.useState([]),[b,j]=r.useState(""),w=(0,s.b7)({data:c,columns:n,state:{sorting:p,globalFilter:b},onSortingChange:v,onGlobalFilterChange:j,getCoreRowModel:(0,i.sC)(),getFilteredRowModel:(0,i.vL)(),getSortedRowModel:(0,i.tj)(),getPaginationRowModel:(0,i.G_)()});r.useEffect(()=>{w.setPageSize(f)},[f,w]);let y=(0,r.useMemo)(()=>u||((e,t)=>{var n;return null!==(n=null==e?void 0:e.id)&&void 0!==n?n:t}),[u]);return(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,a.jsx)("div",{className:"flex items-center gap-2",children:h&&(0,a.jsx)(o.I,{value:null!=b?b:"",placeholder:x,onChange:e=>j(e.target.value),className:"w-64"})}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:g})]}),(0,a.jsx)("div",{className:"overflow-x-auto border rounded-md",children:(0,a.jsxs)(l.iA,{children:[(0,a.jsx)(l.xD,{children:w.getHeaderGroups().map(e=>(0,a.jsx)(l.SC,{children:e.headers.map(e=>{var t;return(0,a.jsx)(l.ss,{className:"whitespace-nowrap select-none",children:e.isPlaceholder?null:(0,a.jsxs)("div",{className:e.column.getCanSort()?"cursor-pointer select-none":"",onClick:e.column.getToggleSortingHandler(),children:[(0,s.ie)(e.column.columnDef.header,e.getContext()),null!==(t=({asc:" ▲",desc:" ▼"})[e.column.getIsSorted()])&&void 0!==t?t:null]})},e.id)})},e.id))}),(0,a.jsx)(l.RM,{children:m?(0,a.jsx)(l.SC,{children:(0,a.jsx)(l.pj,{colSpan:n.length,children:(0,a.jsx)("div",{className:"py-8 text-center text-sm text-muted-foreground",children:"加载中..."})})}):(null===(t=w.getRowModel().rows)||void 0===t?void 0:t.length)?w.getRowModel().rows.map((e,t)=>(0,a.jsx)(l.SC,{children:e.getVisibleCells().map(e=>(0,a.jsx)(l.pj,{children:(0,s.ie)(e.column.columnDef.cell,e.getContext())},e.id))},y(e.original,t))):(0,a.jsx)(l.SC,{children:(0,a.jsx)(l.pj,{colSpan:n.length,children:(0,a.jsx)("div",{className:"py-8 text-center text-sm text-muted-foreground",children:"暂无数据"})})})})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2",children:[(0,a.jsxs)("div",{className:"text-sm text-muted-foreground mr-auto",children:["共 ",c.length," 条，页 ",w.getState().pagination.pageIndex+1," / ",w.getPageCount()||1]}),(0,a.jsx)(d.z,{variant:"outline",size:"sm",onClick:()=>w.previousPage(),disabled:!w.getCanPreviousPage(),children:"上一页"}),(0,a.jsx)(d.z,{variant:"outline",size:"sm",onClick:()=>w.nextPage(),disabled:!w.getCanNextPage(),children:"下一页"})]})]})}},837:function(e,t,n){"use strict";n.d(t,{$N:function(){return x},Vq:function(){return l},cN:function(){return h},cZ:function(){return u},fK:function(){return f},hg:function(){return o}});var a=n(7437);n(2265);var r=n(4858),s=n(7025),i=n(7440);function l(e){let{...t}=e;return(0,a.jsx)(r.fC,{"data-slot":"dialog",...t})}function o(e){let{...t}=e;return(0,a.jsx)(r.xz,{"data-slot":"dialog-trigger",...t})}function d(e){let{...t}=e;return(0,a.jsx)(r.h_,{"data-slot":"dialog-portal",...t})}function c(e){let{className:t,...n}=e;return(0,a.jsx)(r.aV,{"data-slot":"dialog-overlay",className:(0,i.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...n})}function u(e){let{className:t,children:n,showCloseButton:l=!0,...o}=e;return(0,a.jsxs)(d,{"data-slot":"dialog-portal",children:[(0,a.jsx)(c,{}),(0,a.jsxs)(r.VY,{"data-slot":"dialog-content",className:(0,i.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...o,children:[n,l&&(0,a.jsxs)(r.x8,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,a.jsx)(s.Z,{}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function f(e){let{className:t,...n}=e;return(0,a.jsx)("div",{"data-slot":"dialog-header",className:(0,i.cn)("flex flex-col gap-2 text-center sm:text-left",t),...n})}function h(e){let{className:t,...n}=e;return(0,a.jsx)("div",{"data-slot":"dialog-footer",className:(0,i.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...n})}function x(e){let{className:t,...n}=e;return(0,a.jsx)(r.Dx,{"data-slot":"dialog-title",className:(0,i.cn)("text-lg leading-none font-semibold",t),...n})}},3102:function(e,t,n){"use strict";n.d(t,{I:function(){return s}});var a=n(7437);n(2265);var r=n(7440);function s(e){let{className:t,type:n,...s}=e;return(0,a.jsx)("input",{type:n,"data-slot":"input",className:(0,r.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...s})}},7135:function(e,t,n){"use strict";n.d(t,{_:function(){return i}});var a=n(7437);n(2265);var r=n(8364),s=n(7440);function i(e){let{className:t,...n}=e;return(0,a.jsx)(r.f,{"data-slot":"label",className:(0,s.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...n})}},4421:function(e,t,n){"use strict";n.d(t,{r:function(){return i}});var a=n(7437);n(2265);var r=n(7479),s=n(7440);function i(e){let{className:t,...n}=e;return(0,a.jsx)(r.fC,{"data-slot":"switch",className:(0,s.cn)("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...n,children:(0,a.jsx)(r.bU,{"data-slot":"switch-thumb",className:(0,s.cn)("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}},6975:function(e,t,n){"use strict";n.d(t,{RM:function(){return l},SC:function(){return o},iA:function(){return s},pj:function(){return c},ss:function(){return d},xD:function(){return i}});var a=n(7437);n(2265);var r=n(7440);function s(e){let{className:t,...n}=e;return(0,a.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,a.jsx)("table",{"data-slot":"table",className:(0,r.cn)("w-full caption-bottom text-sm",t),...n})})}function i(e){let{className:t,...n}=e;return(0,a.jsx)("thead",{"data-slot":"table-header",className:(0,r.cn)("[&_tr]:border-b",t),...n})}function l(e){let{className:t,...n}=e;return(0,a.jsx)("tbody",{"data-slot":"table-body",className:(0,r.cn)("[&_tr:last-child]:border-0",t),...n})}function o(e){let{className:t,...n}=e;return(0,a.jsx)("tr",{"data-slot":"table-row",className:(0,r.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...n})}function d(e){let{className:t,...n}=e;return(0,a.jsx)("th",{"data-slot":"table-head",className:(0,r.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...n})}function c(e){let{className:t,...n}=e;return(0,a.jsx)("td",{"data-slot":"table-cell",className:(0,r.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...n})}},7440:function(e,t,n){"use strict";n.d(t,{cn:function(){return s}});var a=n(4839),r=n(6164);function s(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,r.m6)((0,a.W)(t))}},8364:function(e,t,n){"use strict";n.d(t,{f:function(){return l}});var a=n(2265),r=n(5171),s=n(7437),i=a.forwardRef((e,t)=>(0,s.jsx)(r.WV.label,{...e,ref:t,onMouseDown:t=>{var n;t.target.closest("button, input, select, textarea")||(null===(n=e.onMouseDown)||void 0===n||n.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));i.displayName="Label";var l=i},7479:function(e,t,n){"use strict";n.d(t,{fC:function(){return w},bU:function(){return y}});var a=n(2265),r=n(8149),s=n(1584),i=n(8324),l=n(1715),o=n(1336),d=n(5171),c=n(7437),u="Switch",[f,h]=(0,i.b)(u),[x,g]=f(u),m=a.forwardRef((e,t)=>{let{__scopeSwitch:n,name:i,checked:o,defaultChecked:f,required:h,disabled:g,value:m="on",onCheckedChange:p,form:v,...w}=e,[y,k]=a.useState(null),N=(0,s.e)(t,e=>k(e)),C=a.useRef(!1),_=!y||v||!!y.closest("form"),[S,z]=(0,l.T)({prop:o,defaultProp:null!=f&&f,onChange:p,caller:u});return(0,c.jsxs)(x,{scope:n,checked:S,disabled:g,children:[(0,c.jsx)(d.WV.button,{type:"button",role:"switch","aria-checked":S,"aria-required":h,"data-state":j(S),"data-disabled":g?"":void 0,disabled:g,value:m,...w,ref:N,onClick:(0,r.Mj)(e.onClick,e=>{z(e=>!e),_&&(C.current=e.isPropagationStopped(),C.current||e.stopPropagation())})}),_&&(0,c.jsx)(b,{control:y,bubbles:!C.current,name:i,value:m,checked:S,required:h,disabled:g,form:v,style:{transform:"translateX(-100%)"}})]})});m.displayName=u;var p="SwitchThumb",v=a.forwardRef((e,t)=>{let{__scopeSwitch:n,...a}=e,r=g(p,n);return(0,c.jsx)(d.WV.span,{"data-state":j(r.checked),"data-disabled":r.disabled?"":void 0,...a,ref:t})});v.displayName=p;var b=a.forwardRef((e,t)=>{let{__scopeSwitch:n,control:r,checked:i,bubbles:l=!0,...d}=e,u=a.useRef(null),f=(0,s.e)(u,t),h=function(e){let t=a.useRef({value:e,previous:e});return a.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}(i),x=function(e){let[t,n]=a.useState(void 0);return(0,o.b)(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{let a,r;if(!Array.isArray(t)||!t.length)return;let s=t[0];if("borderBoxSize"in s){let e=s.borderBoxSize,t=Array.isArray(e)?e[0]:e;a=t.inlineSize,r=t.blockSize}else a=e.offsetWidth,r=e.offsetHeight;n({width:a,height:r})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}n(void 0)},[e]),t}(r);return a.useEffect(()=>{let e=u.current;if(!e)return;let t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(h!==i&&t){let n=new Event("click",{bubbles:l});t.call(e,i),e.dispatchEvent(n)}},[h,i,l]),(0,c.jsx)("input",{type:"checkbox","aria-hidden":!0,defaultChecked:i,...d,tabIndex:-1,ref:f,style:{...d.style,...x,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function j(e){return e?"checked":"unchecked"}b.displayName="SwitchBubbleInput";var w=m,y=v}},function(e){e.O(0,[247,776,514,753,971,23,744],function(){return e(e.s=9257)}),_N_E=e.O()}]);