(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[708],{3216:function(e,t,r){Promise.resolve().then(r.bind(r,9731))},9731:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return d}});var n=r(7437),i=r(2265),a=r(6013),s=r(495),c=r(7135),o=r(7776);function d(){let[e,t]=(0,i.useState)(null),[r,o]=(0,i.useState)(""),[d,h]=(0,i.useState)(""),[f,p]=(0,i.useState)(null),[x,g]=(0,i.useState)(null),[v,m]=(0,i.useState)(""),[b,_]=(0,i.useState)(""),[k,w]=(0,i.useState)("");(0,i.useEffect)(()=>{let e=window.location.hash.startsWith("#")?window.location.hash.slice(1):"",r=window.location.search.startsWith("?")?window.location.search.slice(1):"";t(new URLSearchParams(e||r))},[]),(0,i.useEffect)(()=>{e&&(o(e.get("code")||""),h(e.get("state")||""))},[e]);let j=async()=>{m("");try{let e=JSON.parse(localStorage.getItem("ginkgo-pkce")||"{}"),t=JSON.parse(localStorage.getItem("ginkgo-client")||"null");if(!e.client_id||!e.verifier||!e.redirect_uri)throw Error("缺少 PKCE 上下文，请从客户端页面重新发起授权");let n=new URLSearchParams({grant_type:"authorization_code",code:r,redirect_uri:e.redirect_uri,code_verifier:e.verifier}),i={"Content-Type":"application/x-www-form-urlencoded"};t&&"client_secret_basic"===t.token_endpoint_auth_method&&t.client_secret?i.Authorization="Basic ".concat(btoa("".concat(e.client_id,":").concat(t.client_secret))):(n.set("client_id",e.client_id),t&&"client_secret_post"===t.token_endpoint_auth_method&&t.client_secret&&n.set("client_secret",t.client_secret));let a=await fetch("/token",{method:"POST",body:n,headers:i,credentials:"include"}),s=await a.text();if(!a.ok){let e=s;try{let t=JSON.parse(s),r=t.error||"",n=t.error_description||"";"invalid_client"===r?e="invalid_client：令牌端点客户端认证失败。机密客户端须使用 Basic 携带 client_id/client_secret；公共客户端应配置 token_endpoint_auth_method=none 并仅带 client_id。":"invalid_grant"===r?e="invalid_grant：授权码不可用（已使用/过期）、redirect_uri 不一致、或 PKCE 校验失败。":"unauthorized_client"===r?e="unauthorized_client：客户端未获批准或不存在，请在客户端页面先检查“已批准”状态。":n&&(e=n)}catch(e){}throw Error(e)}let c=JSON.parse(s);if(p(c),localStorage.setItem("ginkgo-tokens",s),c.id_token){let e=function(e){let t=e.split(".");if(t.length<2)return{header:"",payload:""};let r=l(t[0]),n=l(t[1]),i=r,a=n;try{i=JSON.stringify(JSON.parse(r),null,2)}catch(e){}try{a=JSON.stringify(JSON.parse(n),null,2)}catch(e){}return{header:i,payload:a}}(c.id_token);_(e.header),w(e.payload)}}catch(e){m(e.message||"兑换令牌失败")}},y=async()=>{if(!(null==f?void 0:f.access_token))return;let e=await fetch("/userinfo",{headers:{Authorization:"Bearer ".concat(f.access_token)}}),t=await e.text();try{g(JSON.parse(t))}catch(e){g(t)}};return(0,n.jsxs)("div",{className:"container py-10 space-y-6",children:[(0,n.jsxs)(a.Zb,{children:[(0,n.jsxs)(a.Ol,{children:[(0,n.jsx)(a.ll,{children:"回调结果"}),(0,n.jsx)(a.SZ,{children:"从 /authorize 返回的参数"})]}),(0,n.jsxs)(a.aY,{className:"grid gap-2 text-sm",children:[(0,n.jsxs)("div",{children:["code: ",(0,n.jsx)("code",{children:r||"-"})]}),(0,n.jsxs)("div",{children:["state: ",(0,n.jsx)("code",{children:d||"-"})]}),v&&(0,n.jsx)("div",{className:"text-red-500",children:v}),(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsx)(s.z,{onClick:j,disabled:!r,children:"兑换令牌"})})]})]}),f&&(0,n.jsxs)(a.Zb,{children:[(0,n.jsx)(a.Ol,{children:(0,n.jsx)(a.ll,{children:"令牌"})}),(0,n.jsxs)(a.aY,{children:[(0,n.jsx)("pre",{className:"text-xs whitespace-pre-wrap break-all",children:JSON.stringify(f,null,2)}),(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsx)(s.z,{onClick:y,children:"调用 /userinfo"})}),x&&(0,n.jsx)("pre",{className:"text-xs whitespace-pre-wrap break-all mt-2",children:JSON.stringify(x,null,2)}),f.id_token&&(0,n.jsxs)("div",{className:"mt-4 grid gap-2",children:[(0,n.jsx)(c._,{children:"ID Token 解码"}),(0,n.jsxs)("div",{className:"grid md:grid-cols-2 gap-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm text-muted-foreground",children:"Header"}),(0,n.jsx)("pre",{className:"text-xs whitespace-pre-wrap break-all p-2 rounded-md border border-border",children:b})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm text-muted-foreground",children:"Payload"}),(0,n.jsx)("pre",{className:"text-xs whitespace-pre-wrap break-all p-2 rounded-md border border-border",children:k})]})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(s.z,{onClick:()=>u(f.access_token,"access_token"),children:"复制 Access Token"}),(0,n.jsx)(s.z,{onClick:()=>u(f.id_token,"id_token"),children:"复制 ID Token"}),f.refresh_token&&(0,n.jsx)(s.z,{onClick:()=>u(f.refresh_token,"refresh_token"),children:"复制 Refresh Token"})]})]})]})]})]})}function l(e){let t=e.length%4==0?"":"=".repeat(4-e.length%4),r=atob(e.replace(/-/g,"+").replace(/_/g,"/")+t);try{return decodeURIComponent(Array.prototype.map.call(r,e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))}catch(e){return r}}function u(e,t){navigator.clipboard.writeText(e).then(()=>o.Am.success("已复制 ".concat(t))).catch(()=>o.Am.error("复制失败"))}},495:function(e,t,r){"use strict";r.d(t,{z:function(){return o}});var n=r(7437);r(2265);var i=r(1538),a=r(3027),s=r(7440);let c=(0,a.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function o(e){let{className:t,variant:r,size:a,asChild:o=!1,...d}=e,l=o?i.g7:"button";return(0,n.jsx)(l,{"data-slot":"button",className:(0,s.cn)(c({variant:r,size:a,className:t})),...d})}},6013:function(e,t,r){"use strict";r.d(t,{Ol:function(){return s},SZ:function(){return o},Zb:function(){return a},aY:function(){return d},ll:function(){return c}});var n=r(7437);r(2265);var i=r(7440);function a(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card",className:(0,i.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...r})}function s(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-header",className:(0,i.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...r})}function c(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-title",className:(0,i.cn)("leading-none font-semibold",t),...r})}function o(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-description",className:(0,i.cn)("text-muted-foreground text-sm",t),...r})}function d(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-content",className:(0,i.cn)("px-6",t),...r})}},7135:function(e,t,r){"use strict";r.d(t,{_:function(){return s}});var n=r(7437);r(2265);var i=r(8364),a=r(7440);function s(e){let{className:t,...r}=e;return(0,n.jsx)(i.f,{"data-slot":"label",className:(0,a.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...r})}},7440:function(e,t,r){"use strict";r.d(t,{cn:function(){return a}});var n=r(4839),i=r(6164);function a(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,i.m6)((0,n.W)(t))}},8364:function(e,t,r){"use strict";r.d(t,{f:function(){return c}});var n=r(2265),i=r(5171),a=r(7437),s=n.forwardRef((e,t)=>(0,a.jsx)(i.WV.label,{...e,ref:t,onMouseDown:t=>{var r;t.target.closest("button, input, select, textarea")||(null===(r=e.onMouseDown)||void 0===r||r.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));s.displayName="Label";var c=s},5171:function(e,t,r){"use strict";r.d(t,{WV:function(){return c},jH:function(){return o}});var n=r(2265),i=r(4887),a=r(1538),s=r(7437),c=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let r=(0,a.Z8)(`Primitive.${t}`),i=n.forwardRef((e,n)=>{let{asChild:i,...a}=e,c=i?r:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,s.jsx)(c,{...a,ref:n})});return i.displayName=`Primitive.${t}`,{...e,[t]:i}},{});function o(e,t){e&&i.flushSync(()=>e.dispatchEvent(t))}}},function(e){e.O(0,[247,776,971,23,744],function(){return e(e.s=3216)}),_N_E=e.O()}]);