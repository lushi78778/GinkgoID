basePath: /
definitions:
  handlers.brandingSetting:
    properties:
      accent_color:
        type: string
      background_color:
        type: string
      dark_mode_logo_url:
        type: string
      email_body:
        type: string
      email_subject:
        type: string
      logo_url:
        type: string
      primary_color:
        type: string
    type: object
  handlers.mePreferenceReq:
    properties:
      marketing_opt_in:
        type: boolean
    type: object
  handlers.policySetting:
    properties:
      password_min_length:
        type: integer
      password_require_number:
        type: boolean
      password_require_symbol:
        type: boolean
      refresh_token_ttl_days:
        type: integer
      require_mfa:
        type: boolean
      token_ttl_seconds:
        type: integer
    type: object
  oidc.Discovery:
    properties:
      acr_values_supported:
        items:
          type: string
        type: array
      authorization_endpoint:
        type: string
      backchannel_logout_session_supported:
        type: boolean
      backchannel_logout_supported:
        type: boolean
      check_session_iframe:
        type: string
      claims_parameter_supported:
        type: boolean
      claims_supported:
        items:
          type: string
        type: array
      code_challenge_methods_supported:
        items:
          type: string
        type: array
      end_session_endpoint:
        type: string
      frontchannel_logout_session_supported:
        type: boolean
      frontchannel_logout_supported:
        type: boolean
      grant_types_supported:
        items:
          type: string
        type: array
      id_token_signing_alg_values_supported:
        items:
          type: string
        type: array
      introspection_endpoint:
        type: string
      issuer:
        type: string
      jwks_uri:
        type: string
      prompt_values_supported:
        items:
          type: string
        type: array
      registration_endpoint:
        type: string
      request_parameter_supported:
        type: boolean
      request_uri_parameter_supported:
        type: boolean
      response_modes_supported:
        items:
          type: string
        type: array
      response_types_supported:
        items:
          type: string
        type: array
      revocation_endpoint:
        type: string
      scopes_supported:
        items:
          type: string
        type: array
      subject_types_supported:
        items:
          type: string
        type: array
      token_endpoint:
        type: string
      token_endpoint_auth_methods_supported:
        items:
          type: string
        type: array
      userinfo_endpoint:
        type: string
    type: object
  services.RegisterRequest:
    properties:
      application_type:
        type: string
      backchannel_logout_uri:
        type: string
      client_name:
        type: string
      frontchannel_logout_uri:
        type: string
      grant_types:
        items:
          type: string
        type: array
      logo_uri:
        type: string
      post_logout_redirect_uris:
        items:
          type: string
        type: array
      redirect_uris:
        items:
          type: string
        type: array
      response_types:
        items:
          type: string
        type: array
      scope:
        type: string
      sector_identifier_uri:
        type: string
      subject_type:
        description: 取值：public 或 pairwise
        type: string
      token_endpoint_auth_method:
        type: string
    type: object
  services.RegisterResponse:
    properties:
      client_id:
        type: string
      client_id_issued_at:
        type: integer
      client_secret:
        type: string
      client_secret_expires_at:
        type: integer
      grant_types:
        items:
          type: string
        type: array
      redirect_uris:
        items:
          type: string
        type: array
      registration_access_token:
        type: string
      registration_client_uri:
        type: string
      token_endpoint_auth_method:
        type: string
    type: object
  storage.User:
    properties:
      createdAt:
        type: string
      deletionReason:
        type: string
      deletionRequestedAt:
        type: string
      email:
        type: string
      emailVerified:
        type: boolean
      id:
        type: integer
      isAdmin:
        type: boolean
      isDev:
        type: boolean
      marketingOptIn:
        type: boolean
      mfaenabled:
        type: boolean
      mfaenrolledAt:
        type: string
      mfalastUsedAt:
        type: string
      mfapendingRecoveryCodes:
        type: string
      mfapendingSecret:
        type: string
      mfarecoveryCodes:
        type: string
      mfasecret:
        type: string
      name:
        type: string
      password:
        description: 已哈希的口令
        type: string
      pendingEmail:
        type: string
      updatedAt:
        type: string
      username:
        type: string
    type: object
info:
  contact:
    email: lushi78778@xray.top
    name: GinkgoID Team
    url: https://xray.top
  description: 基于 Go(Gin) 的 OpenID Provider，实现 Discovery、JWKS、授权码+PKCE、Token、UserInfo、动态注册、注销、撤销、内省等接口。
  title: GinkgoID OIDC OP API
  version: 0.1.0
paths:
  /.well-known/oauth-authorization-server:
    get:
      description: 获取 OpenID Provider 的元数据文档
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/oidc.Discovery'
      summary: OIDC Discovery
      tags:
      - discovery
  /.well-known/openid-configuration:
    get:
      description: 获取 OpenID Provider 的元数据文档
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/oidc.Discovery'
      summary: OIDC Discovery
      tags:
      - discovery
  /api/admin/branding:
    get:
      description: 读取管理控制台的品牌配色与邮箱模板
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 获取品牌配置
      tags:
      - admin-api
    put:
      consumes:
      - application/json
      description: 保存控制台主题色、Logo 与邮件模板
      parameters:
      - description: 品牌配置
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/handlers.brandingSetting'
      produces:
      - application/json
      responses:
        "204":
          description: No Content
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 更新品牌配置
      tags:
      - admin-api
  /api/admin/clients/{client_id}/approve:
    post:
      parameters:
      - description: 客户端ID
        in: path
        name: client_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "204":
          description: No Content
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Not Found
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 管理员 - 审批通过客户端
      tags:
      - admin-api
  /api/admin/clients/{client_id}/reject:
    post:
      parameters:
      - description: 客户端ID
        in: path
        name: client_id
        required: true
        type: string
      - description: '{reason}'
        in: body
        name: body
        required: true
        schema:
          type: object
      produces:
      - application/json
      responses:
        "204":
          description: No Content
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Not Found
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 管理员 - 审批拒绝客户端
      tags:
      - admin-api
  /api/admin/clients/pending:
    get:
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              additionalProperties: true
              type: object
            type: array
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 管理员 - 待审批客户端列表
      tags:
      - admin-api
  /api/admin/metrics:
    get:
      description: 汇总平台用户、客户端与登录统计
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 管理员仪表盘指标
      tags:
      - admin-api
  /api/admin/policies:
    put:
      consumes:
      - application/json
      description: 保存口令复杂度、令牌 TTL、MFA 要求等策略
      parameters:
      - description: 安全策略
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/handlers.policySetting'
      produces:
      - application/json
      responses:
        "204":
          description: No Content
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 更新安全策略
      tags:
      - admin-api
  /api/admin/roles:
    put:
      consumes:
      - application/json
      description: 设置平台角色及其权限列表
      parameters:
      - description: 角色列表
        in: body
        name: body
        required: true
        schema:
          items:
            additionalProperties: true
            type: object
          type: array
      produces:
      - application/json
      responses:
        "204":
          description: No Content
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 更新角色权限
      tags:
      - admin-api
  /api/admin/scopes:
    put:
      consumes:
      - application/json
      description: 覆盖平台支持的 scope 列表及对应 claim
      parameters:
      - description: Scope 列表
        in: body
        name: body
        required: true
        schema:
          items:
            additionalProperties: true
            type: object
          type: array
      produces:
      - application/json
      responses:
        "204":
          description: No Content
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 更新 scope 配置
      tags:
      - admin-api
  /api/admin/settings:
    get:
      description: 读取平台的 scope、角色与安全策略配置
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 管理员设置读取
      tags:
      - admin-api
  /api/consents:
    get:
      description: 列出当前用户对各客户端已授予的 scope
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              additionalProperties: true
              type: object
            type: array
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 授权记录列表
      tags:
      - consent-api
  /api/consents/{client_id}:
    delete:
      description: 撤销当前用户对指定 client 的授权，并尝试吊销关联的刷新令牌
      parameters:
      - description: 客户端 ID
        in: path
        name: client_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "204":
          description: No Content
          schema:
            type: string
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 撤销授权
      tags:
      - consent-api
  /api/logs:
    get:
      parameters:
      - description: 开始时间(Unix秒)
        in: query
        name: from
        type: string
      - description: 结束时间(Unix秒)
        in: query
        name: to
        type: string
      - description: 级别
        in: query
        name: level
        type: string
      - description: 事件
        in: query
        name: event
        type: string
      - description: 用户ID
        format: int64
        in: query
        name: user
        type: integer
      - description: 客户端ID
        in: query
        name: client
        type: string
      - description: 数量(<=1000)
        in: query
        name: limit
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              additionalProperties: true
              type: object
            type: array
      summary: 管理员 - 审计日志查询
      tags:
      - admin-api
  /api/me:
    get:
      description: 读取当前登录用户的基础资料
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 当前用户信息
      tags:
      - user-api
    put:
      consumes:
      - application/json
      description: 更新当前登录用户的姓名/邮箱
      parameters:
      - description: '{name,email}'
        in: body
        name: body
        required: true
        schema:
          type: object
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 更新我的资料
      tags:
      - user-api
  /api/me/email/verify:
    post:
      description: 当前未配置邮件发送服务时会返回 501
      produces:
      - application/json
      responses:
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "501":
          description: Not Implemented
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 请求发送邮箱验证
      tags:
      - user-api
  /api/me/password:
    post:
      consumes:
      - application/json
      description: 需要提供旧口令与新口令
      parameters:
      - description: '{oldPassword,newPassword}'
        in: body
        name: body
        required: true
        schema:
          type: object
      produces:
      - application/json
      responses:
        "204":
          description: No Content
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 修改我的口令
      tags:
      - user-api
  /api/me/preferences:
    put:
      consumes:
      - application/json
      description: 修改当前登录用户的营销订阅等偏好设置
      parameters:
      - description: 偏好设置
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/handlers.mePreferenceReq'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 更新用户偏好
      tags:
      - user-api
  /api/my/clients:
    get:
      description: 返回我拥有的已注册客户端（应用）
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              additionalProperties: true
              type: object
            type: array
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 我的应用列表
      tags:
      - client-api
  /api/my/clients/{client_id}:
    delete:
      description: 物理删除我拥有的客户端
      parameters:
      - description: 客户端 ID
        in: path
        name: client_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "204":
          description: No Content
          schema:
            type: string
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 删除我的客户端
      tags:
      - client-api
  /api/my/clients/{client_id}/analytics:
    get:
      description: 获取客户端最近授权与登录统计信息
      parameters:
      - description: 客户端 ID
        in: path
        name: client_id
        required: true
        type: string
      - description: 统计周期
        in: query
        name: period
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 客户端统计
      tags:
      - developer-api
  /api/my/clients/{client_id}/disable:
    put:
      description: 将指定客户端置为禁用状态（enabled=false）
      parameters:
      - description: 客户端 ID
        in: path
        name: client_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "204":
          description: No Content
          schema:
            type: string
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 禁用我的客户端
      tags:
      - client-api
  /api/my/clients/{client_id}/enable:
    put:
      description: 将指定客户端置为启用状态（enabled=true）
      parameters:
      - description: 客户端 ID
        in: path
        name: client_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "204":
          description: No Content
          schema:
            type: string
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 启用我的客户端
      tags:
      - client-api
  /api/my/clients/{client_id}/logs:
    get:
      description: 查询当前登录用户拥有的客户端的授权与令牌日志
      parameters:
      - description: 客户端 ID
        in: path
        name: client_id
        required: true
        type: string
      - description: 日志级别
        in: query
        name: level
        type: string
      - description: 关键字过滤
        in: query
        name: q
        type: string
      - description: 返回数量
        in: query
        name: limit
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              additionalProperties: true
              type: object
            type: array
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 客户端日志
      tags:
      - developer-api
  /api/my/clients/{client_id}/users:
    get:
      description: 列出指定客户端已授权的终端用户
      parameters:
      - description: 客户端 ID
        in: path
        name: client_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              additionalProperties: true
              type: object
            type: array
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 客户端授权用户
      tags:
      - developer-api
  /api/my/clients/{client_id}/users/{user_id}:
    delete:
      description: 撤销指定用户对客户端的授权
      parameters:
      - description: 客户端 ID
        in: path
        name: client_id
        required: true
        type: string
      - description: 用户 ID
        in: path
        name: user_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "204":
          description: No Content
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "403":
          description: Forbidden
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 解除客户端授权
      tags:
      - developer-api
  /api/privacy/delete:
    post:
      description: 提交删除当前用户数据的请求
      produces:
      - application/json
      responses:
        "202":
          description: Accepted
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 删除个人数据
      tags:
      - user-privacy
  /api/privacy/export:
    post:
      description: 触发当前用户的数据导出请求，生成临时下载链接
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 导出个人数据
      tags:
      - user-privacy
  /api/privacy/export/{token}:
    get:
      description: 通过导出令牌下载个人数据归档
      parameters:
      - description: 导出令牌
        in: path
        name: token
        required: true
        type: string
      produces:
      - application/zip
      responses:
        "200":
          description: OK
          schema:
            type: file
        "404":
          description: Not Found
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 下载导出结果
      tags:
      - user-privacy
  /api/security/mfa:
    delete:
      description: 禁用当前用户的多因素认证配置
      produces:
      - application/json
      responses:
        "204":
          description: No Content
          schema:
            type: string
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 关闭 MFA
      tags:
      - user-security
    get:
      description: 读取当前用户的多因素认证配置，包括密钥、恢复码等
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 获取 MFA 状态
      tags:
      - user-security
  /api/security/mfa/activate:
    post:
      consumes:
      - application/json
      description: 校验一次性验证码并启用当前用户的 MFA
      parameters:
      - description: 验证码参数
        in: body
        name: body
        required: true
        schema:
          additionalProperties:
            type: string
          type: object
      produces:
      - application/json
      responses:
        "204":
          description: No Content
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 激活 MFA
      tags:
      - user-security
  /api/security/mfa/setup:
    post:
      description: 为当前用户生成新的 TOTP 秘钥和恢复码用于绑定 MFA
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 生成 MFA 绑定信息
      tags:
      - user-security
  /api/security/sessions:
    delete:
      description: 注销除当前会话外的全部登录会话
      produces:
      - application/json
      responses:
        "204":
          description: No Content
          schema:
            type: string
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 注销其他会话
      tags:
      - user-security
    get:
      description: 列出当前用户的所有活跃会话
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              additionalProperties: true
              type: object
            type: array
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 会话列表
      tags:
      - user-security
  /api/security/sessions/{id}:
    delete:
      description: 注销当前用户的指定会话 ID
      parameters:
      - description: 会话 ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "204":
          description: No Content
          schema:
            type: string
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Not Found
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 注销指定会话
      tags:
      - user-security
  /api/self/logs:
    get:
      description: 查询当前登录用户的安全事件日志，可按级别、关键词和时间范围过滤
      parameters:
      - description: 日志级别
        in: query
        name: level
        type: string
      - description: 关键字过滤
        in: query
        name: search
        type: string
      - description: 起始时间(YYYY-MM-DD 或 Unix 秒)
        in: query
        name: from
        type: string
      - description: 结束时间(YYYY-MM-DD 或 Unix 秒)
        in: query
        name: to
        type: string
      - description: 返回数量上限
        in: query
        name: limit
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              additionalProperties: true
              type: object
            type: array
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 用户安全日志
      tags:
      - user-api
  /api/users:
    get:
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              additionalProperties: true
              type: object
            type: array
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 管理员 - 用户列表
      tags:
      - admin-api
    post:
      consumes:
      - application/json
      parameters:
      - description: '{username,password,email,name,is_admin,is_dev}'
        in: body
        name: body
        required: true
        schema:
          type: object
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 管理员 - 创建用户
      tags:
      - admin-api
  /api/users/{id}:
    put:
      consumes:
      - application/json
      parameters:
      - description: 用户ID
        in: path
        name: id
        required: true
        type: integer
      - description: '{email,name,is_admin,is_dev,password}'
        in: body
        name: body
        required: true
        schema:
          type: object
      produces:
      - application/json
      responses:
        "204":
          description: No Content
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "404":
          description: Not Found
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 管理员 - 更新用户
      tags:
      - admin-api
  /authorize:
    get:
      description: 实现授权码 + PKCE 及可选 Hybrid 流程
      parameters:
      - description: code 或 code id_token
        in: query
        name: response_type
        required: true
        type: string
      - description: 客户端 ID
        in: query
        name: client_id
        required: true
        type: string
      - description: 重定向 URI
        in: query
        name: redirect_uri
        required: true
        type: string
      - description: openid 等空格分隔
        in: query
        name: scope
        required: true
        type: string
      - description: 状态参数
        in: query
        name: state
        type: string
      - description: Hybrid 必需
        in: query
        name: nonce
        type: string
      - description: fragment|form_post|query
        in: query
        name: response_mode
        type: string
      - description: PKCE 挑战
        in: query
        name: code_challenge
        type: string
      - description: S256|plain
        in: query
        name: code_challenge_method
        type: string
      - description: none|login|consent
        in: query
        name: prompt
        type: string
      - description: ACR 要求
        in: query
        name: acr_values
        type: string
      produces:
      - text/html
      responses:
        "302":
          description: 重定向到 redirect_uri
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 授权端点（Authorization）
      tags:
      - oauth2
  /check_session:
    get:
      description: 用于 RP 轮询检查 OP 登录状态的 iframe
      produces:
      - text/html
      responses:
        "200":
          description: HTML
          schema:
            type: string
      summary: 会话探测 Iframe（简化）
      tags:
      - session-management
  /consent:
    get:
      description: 显示授权范围供用户确认
      parameters:
      - description: 客户端 ID
        in: query
        name: client_id
        required: true
        type: string
      - description: 请求的 scope（空格分隔）
        in: query
        name: scope
        required: true
        type: string
      produces:
      - text/html
      responses:
        "200":
          description: HTML
          schema:
            type: string
      summary: 授权同意页
      tags:
      - ui
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: 处理用户对授权的同意或拒绝
      parameters:
      - description: approve 或 deny
        in: formData
        name: decision
        required: true
        type: string
      produces:
      - text/html
      responses:
        "302":
          description: 重定向至 /authorize
          schema:
            type: string
      summary: 提交授权同意
      tags:
      - ui
  /dev/keys/rotate:
    post:
      description: （仅限非生产环境）触发一次新的 JWK 生成
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 开发辅助 - 轮换密钥
      tags:
      - dev
  /dev/users:
    get:
      description: （仅限非生产环境）列出所有用户
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/storage.User'
            type: array
      summary: 开发辅助 - 用户列表
      tags:
      - dev
    post:
      consumes:
      - application/json
      description: （仅限非生产环境）快速创建用户
      parameters:
      - description: '{username,password}'
        in: body
        name: body
        required: true
        schema:
          type: object
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 开发辅助 - 创建用户
      tags:
      - dev
  /healthz:
    get:
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 健康检查
      tags:
      - operations
  /introspect:
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: 返回访问令牌的有效性与基础元信息
      parameters:
      - description: 要内省的令牌
        in: formData
        name: token
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{ active: bool, ... }'
          schema:
            additionalProperties: true
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BasicAuth: []
      summary: 内省端点（Introspection）
      tags:
      - oauth2
  /jwks.json:
    get:
      description: 返回用于验证 ID Token/Access Token 的公钥集合（JWK Set）
      produces:
      - application/json
      responses:
        "200":
          description: JWKS JSON
          schema:
            type: string
      summary: JWKS 公钥集合
      tags:
      - discovery
  /login:
    get:
      description: 显示用户名密码登录表单
      produces:
      - text/html
      responses:
        "200":
          description: HTML
          schema:
            type: string
      summary: 登录页
      tags:
      - ui
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: 处理用户名密码登录请求
      parameters:
      - description: 用户名
        in: formData
        name: username
        required: true
        type: string
      - description: 密码
        in: formData
        name: password
        required: true
        type: string
      produces:
      - text/html
      responses:
        "302":
          description: 重定向至 /authorize
          schema:
            type: string
        "401":
          description: HTML 登录页（含错误）
          schema:
            type: string
      summary: 提交登录
      tags:
      - ui
  /logout:
    get:
      description: 清理 OP 会话并通知已登录 RP；可选重定向
      parameters:
      - description: RP 提供的 ID Token
        in: query
        name: id_token_hint
        type: string
      - description: 注销后重定向 URI
        in: query
        name: post_logout_redirect_uri
        type: string
      - description: 重定向回传状态
        in: query
        name: state
        type: string
      produces:
      - text/html
      responses:
        "200":
          description: HTML 或 302 重定向
          schema:
            type: string
      summary: 注销（RP-Initiated Logout）
      tags:
      - session-management
  /metrics:
    get:
      description: 暴露 Prometheus 指标（text/plain; version=0.0.4）
      produces:
      - text/plain
      responses:
        "200":
          description: OK
          schema:
            type: string
      summary: Prometheus 指标
      tags:
      - operations
  /register:
    delete:
      description: 使用 registration_access_token 将客户端标记为未批准
      parameters:
      - description: 客户端 ID
        in: query
        name: client_id
        required: true
        type: string
      - description: Bearer {registration_access_token}
        in: header
        name: Authorization
        required: true
        type: string
      produces:
      - application/json
      responses:
        "204":
          description: No Content
          schema:
            type: string
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 禁用已注册客户端
      tags:
      - registration
    get:
      description: 使用 registration_access_token 返回客户端元数据
      parameters:
      - description: 客户端 ID
        in: query
        name: client_id
        required: true
        type: string
      - description: Bearer {registration_access_token}
        in: header
        name: Authorization
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 获取已注册客户端
      tags:
      - registration
    post:
      consumes:
      - application/json
      description: 按 OIDC Dynamic Client Registration 注册新客户端
      parameters:
      - description: 注册请求体
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/services.RegisterRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/services.RegisterResponse'
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 动态注册客户端
      tags:
      - registration
    put:
      consumes:
      - application/json
      description: 使用 registration_access_token 更新客户端元数据
      parameters:
      - description: 客户端 ID
        in: query
        name: client_id
        required: true
        type: string
      - description: Bearer {registration_access_token}
        in: header
        name: Authorization
        required: true
        type: string
      - description: 变更字段
        in: body
        name: body
        required: true
        schema:
          type: object
      produces:
      - application/json
      responses:
        "204":
          description: No Content
          schema:
            type: string
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 更新已注册客户端
      tags:
      - registration
  /register/rotate:
    post:
      description: 使用现有 registration_access_token 轮换获取新的 token
      parameters:
      - description: 客户端 ID
        in: query
        name: client_id
        required: true
        type: string
      - description: Bearer {registration_access_token}
        in: header
        name: Authorization
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: '{\"registration_access_token\":\"...\"}'
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      summary: 轮换 Registration Access Token
      tags:
      - registration
  /revoke:
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: 撤销访问令牌或刷新令牌
      parameters:
      - description: 要撤销的令牌
        in: formData
        name: token
        required: true
        type: string
      - description: access_token|refresh_token
        in: formData
        name: token_type_hint
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            type: string
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BasicAuth: []
      summary: 吊销端点（Revocation）
      tags:
      - oauth2
  /token:
    post:
      consumes:
      - application/x-www-form-urlencoded
      description: 交换授权码为令牌，或使用刷新令牌换新令牌
      parameters:
      - description: authorization_code 或 refresh_token
        in: formData
        name: grant_type
        required: true
        type: string
      - description: 授权码（授权码模式）
        in: formData
        name: code
        type: string
      - description: 必须与授权时相同
        in: formData
        name: redirect_uri
        type: string
      - description: PKCE 校验所需
        in: formData
        name: code_verifier
        type: string
      - description: 刷新令牌（刷新模式）
        in: formData
        name: refresh_token
        type: string
      - description: 当未使用 Basic 时必填
        in: formData
        name: client_id
        type: string
      - description: 当未使用 Basic 时必填
        in: formData
        name: client_secret
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: 包含 access_token/id_token/refresh_token
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Bad Request
          schema:
            additionalProperties:
              type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BasicAuth: []
      summary: 令牌端点（Token）
      tags:
      - oauth2
  /userinfo:
    get:
      description: 使用 Access Token 获取用户 claims 信息
      parameters:
      - description: Bearer {access_token}
        in: header
        name: Authorization
        type: string
      - description: 当未设置 Authorization 时可使用
        in: query
        name: access_token
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: 用户信息端点（UserInfo）
      tags:
      - oidc
    post:
      description: 使用 Access Token 获取用户 claims 信息
      parameters:
      - description: Bearer {access_token}
        in: header
        name: Authorization
        type: string
      - description: 当未设置 Authorization 时可使用
        in: query
        name: access_token
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "401":
          description: Unauthorized
          schema:
            additionalProperties:
              type: string
            type: object
      security:
      - BearerAuth: []
      summary: 用户信息端点（UserInfo）
      tags:
      - oidc
schemes:
- http
- https
securityDefinitions:
  BasicAuth:
    type: basic
  BearerAuth:
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
